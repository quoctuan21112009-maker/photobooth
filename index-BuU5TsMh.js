import{L as S,e as z,D as Dt,G as gn,a2 as A,o as w,a3 as P,a4 as H,M as pn,a5 as m,b as oe,w as vn,u as $,F as xe,a6 as He,a7 as ie,N as nt,X as D,S as Ht,j as Ye,k as bn,r as re,c as W,a8 as ze,a9 as it,aa as Si,U as wn,J as yn,ab as Ge,ac as $e,ad as xn,ae as Rn}from"./ant-design-vue-DOimKarp.js";import{I as zn,_ as Be,M as Pe,S as Mi,B as ye,a as Jt,u as An,D as Sn}from"./app-Dovg4VZ6.js";import{u as Ci}from"./useFrame-DSKA-6DL.js";import{S as Mn}from"./SidebarMenu-BSRgu2ra.js";import{u as Cn}from"./photo-DPV2Ki9n.js";import"./apiServices-Bdte_6wB.js";var Tn={icon:{tag:"svg",attrs:{viewBox:"0 0 1024 1024",focusable:"false"},children:[{tag:"path",attrs:{d:"M136 552h63.6c4.4 0 8-3.6 8-8V288.7h528.6v72.6c0 1.9.6 3.7 1.8 5.2a8.3 8.3 0 0011.7 1.4L893 255.4c4.3-5 3.6-10.3 0-13.2L749.7 129.8a8.22 8.22 0 00-5.2-1.8c-4.6 0-8.4 3.8-8.4 8.4V209H199.7c-39.5 0-71.7 32.2-71.7 71.8V544c0 4.4 3.6 8 8 8zm752-80h-63.6c-4.4 0-8 3.6-8 8v255.3H287.8v-72.6c0-1.9-.6-3.7-1.8-5.2a8.3 8.3 0 00-11.7-1.4L131 768.6c-4.3 5-3.6 10.3 0 13.2l143.3 112.4c1.5 1.2 3.3 1.8 5.2 1.8 4.6 0 8.4-3.8 8.4-8.4V815h536.6c39.5 0 71.7-32.2 71.7-71.8V480c-.2-4.4-3.8-8-8.2-8z"}}]},name:"retweet",theme:"outlined"};function ei(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?Object(arguments[t]):{},o=Object.keys(i);typeof Object.getOwnPropertySymbols=="function"&&(o=o.concat(Object.getOwnPropertySymbols(i).filter(function(s){return Object.getOwnPropertyDescriptor(i,s).enumerable}))),o.forEach(function(s){En(e,s,i[s])})}return e}function En(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}var Ft=function(t,i){var o=ei({},t,i.attrs);return S(zn,ei({},o,{icon:Tn}),null)};Ft.displayName="RetweetOutlined";Ft.inheritAttrs=!1;const _n=["src","alt"],kn={key:0,class:"spinner-wrapper"},On={__name:"LazyFramePreview",props:{src:{type:String,required:!0},alt:{type:String,default:"Khung ảnh"}},setup(e){const t=e,i=z(null),o=z(!1);let s=null;return Dt(()=>{s=new IntersectionObserver(([n])=>{if(n.isIntersecting){const r=new Image;r.src=t.src,r.onload=()=>{o.value=!0},s.unobserve(i.value)}},{rootMargin:"40px"}),i.value&&s.observe(i.value)}),gn(()=>{s&&s.disconnect()}),(n,r)=>(w(),A("div",{ref_key:"container",ref:i,class:"lazy-frame-container"},[S(pn,{name:"image-fade"},{default:H(()=>[o.value?(w(),A("img",{key:0,src:e.src,alt:e.alt,class:"lazy-frame-loaded"},null,8,_n)):P("",!0)]),_:1}),o.value?P("",!0):(w(),A("div",kn,r[0]||(r[0]=[m("div",{class:"loading-spinner"},null,-1)])))],512))}},jn=Be(On,[["__scopeId","data-v-c4969962"]]),In={key:0,class:"text-sm text-success"},Ln={key:1,class:"text-sm text-info"},Wn={class:"category-filter-container mb-4"},$n={key:2,class:"loading-container"},Pn={key:3,class:"template-grid"},Dn=["onClick"],Hn={class:"title-frame"},Fn={key:2},Bn={class:"preview-modal-body"},Un={key:0,class:"preview-loading-container"},qn={class:"preview-content"},Xn={class:"single-layout-preview"},Vn=["src"],Nn=["src"],Yn={key:0,class:"preview-text text-sm text-success"},Gn={key:1,class:"preview-actions"},Zn={__name:"FrameSelectionModal",props:{visible:Boolean,currentShape:String},emits:["select","close"],setup(e,{emit:t}){const i=e,o=t,s=z(!1),n=z([]),r=z(null),l=z([]),a=z(""),h=z(!1),c=z(null),u=z(!1),g={square:"https://cdn.freehihi.com/preview/1x4.webp",grid:"https://cdn.freehihi.com/preview/2x2.webp",bigrectangle:"https://cdn.freehihi.com/preview/2x3.webp"},p=oe(()=>i.currentShape==="square"),x=oe(()=>p.value?"Chọn Khung Hỗ Trợ Chụp":"Xem Trước Khung Mẫu"),b=oe(()=>g[i.currentShape]||""),E=j=>{c.value=j,h.value=!0,u.value=!0;const y=C=>new Promise((Y,ve)=>{if(!C){Y();return}const Me=new Image;Me.src=C,Me.onload=Y,Me.onerror=ve});Promise.all([y(b.value),y(j)]).catch(C=>{console.error("Lỗi khi tải ảnh xem trước:",C)}).finally(()=>{u.value=!1})},M=()=>{c.value&&o("select",c.value),T()},T=()=>{h.value=!1,setTimeout(()=>{c.value=null},300)},I=async()=>{try{const y=await Jt.get("https://photo.freehihi.com/api/categories");y.data&&Array.isArray(y.data.data)&&(l.value=[{value:"",label:"Tất Cả Frame"},...y.data.data.map(C=>({value:C.id,label:C.name}))])}catch(j){console.error("Lỗi khi tải danh mục:",j),l.value=[{value:"",label:"Tất Cả Frame"}]}},O=async()=>{try{let y=`https://photo.freehihi.com/api/frame?frame=${i.currentShape||"square"}`;a.value&&(y+=`&category_id=${a.value}`);const C=await Jt.get(y);n.value=C.data||[]}catch(j){console.error("Lỗi khi tải khung",j),n.value=[]}finally{s.value=!1}},fe=()=>{s.value=!0,O()};vn(()=>i.visible,j=>{j===!0?(s.value=!0,n.value=[],I(),O()):(n.value=[],l.value=[],a.value="")});const Ae=j=>{const y=[...j];for(let C=y.length-1;C>0;C--){const Y=Math.floor(Math.random()*(C+1));[y[C],y[Y]]=[y[Y],y[C]]}return y},V=oe(()=>n.value?Ae(n.value):[]);function Z(j){return`https://cdn.freehihi.com/${j}`}function Se(){o("close")}function me(){r.value&&r.value.click()}function he(j){const y=j.target.files[0];if(y&&y.type.startsWith("image/")){const C=URL.createObjectURL(y);o("select",C)}else y&&alert("Vui lòng chỉ chọn tệp hình ảnh.");j.target.value=""}return(j,y)=>(w(),A(xe,null,[S($(Pe),{visible:e.visible,onCancel:Se,footer:null,title:x.value,width:"90vw",class:"frame-selection-modal"},{default:H(()=>[p.value?(w(),A("p",In," Tính năng này giúp bạn xem trước khung và căn chỉnh góc chụp dễ dàng hơn (Chỉ Hoạt Động Với Layout 1x4). ")):(w(),A("p",Ln," Đây là các khung mẫu cho layout bạn đã chọn. Hãy tiến hành chụp ảnh, bạn sẽ được chọn và ghép khung ở bước cuối cùng. ")),m("div",Wn,[S($(Mi),{value:a.value,"onUpdate:value":y[0]||(y[0]=C=>a.value=C),options:l.value,style:{width:"100%",color:"#374151"},placeholder:"Lọc theo danh mục",onChange:fe,disabled:s.value},null,8,["value","options","disabled"])]),m("input",{type:"file",ref_key:"fileInput",ref:r,onChange:he,accept:"image/*",hidden:""},null,544),s.value?(w(),A("div",$n,y[1]||(y[1]=[m("div",{class:"loading-spinner-small"},null,-1)]))):(w(),A("div",Pn,[p.value?(w(),A("div",{key:0,class:"template-frame upload-frame",onClick:me},y[2]||(y[2]=[m("div",{class:"upload-content"},[m("svg",{xmlns:"http://www.w3.org/2000/svg",width:"32",height:"32",fill:"currentColor",class:"bi bi-upload",viewBox:"0 0 16 16"},[m("path",{d:"M.5 9.9V13a2 2 0 0 0 2 2h11a2 2 0 0 0 2-2V9.9a.5.5 0 0 1 1 0V13a3 3 0 0 1-3 3H2.5a3 3 0 0 1-3-3V9.9a.5.5 0 0 1 1 0z"}),m("path",{d:"M7.646 1.146a.5.5 0 0 1 .708 0l3 3a.5.5 0 0 1-.708.708L8.5 2.707V11.5a.5.5 0 0 1-1 0V2.707L5.354 4.854a.5.5 0 1 1-.708-.708l3-3z"})]),m("p",{class:"title-frame"},"Tải lên khung của bạn")],-1)]))):P("",!0),V.value&&V.value.length?(w(!0),A(xe,{key:1},He(V.value,(C,Y)=>(w(),A("div",{key:Y,class:"template-frame",onClick:ve=>E(Z(C.filename))},[S(jn,{src:Z(C.filename),alt:"Khung ảnh"},null,8,["src"]),m("p",Hn,ie(C.name),1)],8,Dn))),128)):s.value?P("",!0):(w(),A("p",Fn,"Không có khung nào trong danh mục này."))]))]),_:1},8,["visible","title"]),S($(Pe),{visible:h.value,footer:null,closable:!0,onCancel:T,centered:"",width:"500px",class:"large-preview-modal",zIndex:9999},{default:H(()=>[m("div",Bn,[u.value?(w(),A("div",Un,y[3]||(y[3]=[m("div",{class:"loading-spinner-large"},null,-1)]))):P("",!0),nt(m("div",qn,[m("div",Xn,[m("img",{src:b.value,alt:"Layout Preview",class:"layout-background-image"},null,8,Vn),c.value?(w(),A("img",{key:0,src:c.value,alt:"Frame Overlay",class:"frame-overlay-on-preview"},null,8,Nn)):P("",!0)]),p.value?P("",!0):(w(),A("p",Yn," Hãy tiến hành chụp ảnh trước để sử dụng khung này. Khung sẽ được ghép vào ở bước cuối cùng! ")),p.value?(w(),A("div",Gn,[S($(ye),{type:"primary",size:"large",onClick:M},{default:H(()=>y[4]||(y[4]=[D(" Xác nhận & Áp dụng ",-1)])),_:1,__:[4]})])):P("",!0)],512),[[Ht,!u.value]])])]),_:1},8,["visible"])],64))}},Kn=Be(Zn,[["__scopeId","data-v-4e927b2b"]]);var ft,ti;function Ti(){if(ti)return ft;ti=1;function e(t){var i=typeof t;return t!=null&&(i=="object"||i=="function")}return ft=e,ft}var mt,ii;function Qn(){if(ii)return mt;ii=1;var e=typeof Ye=="object"&&Ye&&Ye.Object===Object&&Ye;return mt=e,mt}var gt,ni;function Ei(){if(ni)return gt;ni=1;var e=Qn(),t=typeof self=="object"&&self&&self.Object===Object&&self,i=e||t||Function("return this")();return gt=i,gt}var pt,oi;function Jn(){if(oi)return pt;oi=1;var e=Ei(),t=function(){return e.Date.now()};return pt=t,pt}var vt,si;function eo(){if(si)return vt;si=1;var e=/\s/;function t(i){for(var o=i.length;o--&&e.test(i.charAt(o)););return o}return vt=t,vt}var bt,ai;function to(){if(ai)return bt;ai=1;var e=eo(),t=/^\s+/;function i(o){return o&&o.slice(0,e(o)+1).replace(t,"")}return bt=i,bt}var wt,ri;function _i(){if(ri)return wt;ri=1;var e=Ei(),t=e.Symbol;return wt=t,wt}var yt,li;function io(){if(li)return yt;li=1;var e=_i(),t=Object.prototype,i=t.hasOwnProperty,o=t.toString,s=e?e.toStringTag:void 0;function n(r){var l=i.call(r,s),a=r[s];try{r[s]=void 0;var h=!0}catch{}var c=o.call(r);return h&&(l?r[s]=a:delete r[s]),c}return yt=n,yt}var xt,hi;function no(){if(hi)return xt;hi=1;var e=Object.prototype,t=e.toString;function i(o){return t.call(o)}return xt=i,xt}var Rt,ci;function oo(){if(ci)return Rt;ci=1;var e=_i(),t=io(),i=no(),o="[object Null]",s="[object Undefined]",n=e?e.toStringTag:void 0;function r(l){return l==null?l===void 0?s:o:n&&n in Object(l)?t(l):i(l)}return Rt=r,Rt}var zt,ui;function so(){if(ui)return zt;ui=1;function e(t){return t!=null&&typeof t=="object"}return zt=e,zt}var At,di;function ao(){if(di)return At;di=1;var e=oo(),t=so(),i="[object Symbol]";function o(s){return typeof s=="symbol"||t(s)&&e(s)==i}return At=o,At}var St,fi;function ro(){if(fi)return St;fi=1;var e=to(),t=Ti(),i=ao(),o=NaN,s=/^[-+]0x[0-9a-f]+$/i,n=/^0b[01]+$/i,r=/^0o[0-7]+$/i,l=parseInt;function a(h){if(typeof h=="number")return h;if(i(h))return o;if(t(h)){var c=typeof h.valueOf=="function"?h.valueOf():h;h=t(c)?c+"":c}if(typeof h!="string")return h===0?h:+h;h=e(h);var u=n.test(h);return u||r.test(h)?l(h.slice(2),u?2:8):s.test(h)?o:+h}return St=a,St}var Mt,mi;function lo(){if(mi)return Mt;mi=1;var e=Ti(),t=Jn(),i=ro(),o="Expected a function",s=Math.max,n=Math.min;function r(l,a,h){var c,u,g,p,x,b,E=0,M=!1,T=!1,I=!0;if(typeof l!="function")throw new TypeError(o);a=i(a)||0,e(h)&&(M=!!h.leading,T="maxWait"in h,g=T?s(i(h.maxWait)||0,a):g,I="trailing"in h?!!h.trailing:I);function O(y){var C=c,Y=u;return c=u=void 0,E=y,p=l.apply(Y,C),p}function fe(y){return E=y,x=setTimeout(Z,a),M?O(y):p}function Ae(y){var C=y-b,Y=y-E,ve=a-C;return T?n(ve,g-Y):ve}function V(y){var C=y-b,Y=y-E;return b===void 0||C>=a||C<0||T&&Y>=g}function Z(){var y=t();if(V(y))return Se(y);x=setTimeout(Z,Ae(y))}function Se(y){return x=void 0,I&&c?O(y):(c=u=void 0,p)}function me(){x!==void 0&&clearTimeout(x),E=0,c=b=u=x=void 0}function he(){return x===void 0?p:Se(t())}function j(){var y=t(),C=V(y);if(c=arguments,u=this,b=y,C){if(x===void 0)return fe(b);if(T)return clearTimeout(x),x=setTimeout(Z,a),O(b)}return x===void 0&&(x=setTimeout(Z,a)),p}return j.cancel=me,j.flush=he,j}return Mt=r,Mt}var ho=lo();const co=bn(ho),uo={};function fo(e,t){return w(),A("div",null,t[0]||(t[0]=[m("div",{class:"d-flex flex-column justify-content-center align-items-end"},[m("h1",{class:"title"},"PhotoXinhh"),m("p",{class:"s-title"},"Capture Memories")],-1)]))}const mo=Be(uo,[["render",fo]]),go={class:"selecting-container d-flex gap-3 pb-4 ms-3 justify-content-start align-items-start",style:{"font-family":"'Segoe UI', Tahoma, Geneva, Verdana, sans-serif",position:"relative"}},po={class:"selecting-box d-flex flex-column justify-content-start align-items-start"},vo={class:"selecting-box d-flex flex-column justify-content-start align-items-start"},bo={key:0,class:"selecting-box d-flex flex-column justify-content-start align-items-start"},wo={class:"text-blue"},yo={class:"d-flex align-items-center gap-2"},xo={class:"selecting-box d-none d-flex flex-column justify-content-start align-items-start"},Ro={components:{"a-select":Mi,"a-button":ye}},zo=Object.assign(Ro,{__name:"Selecting",props:["setTime","setQuantity","previewFrame"],emits:["open-frame-modal","remove-frame"],setup(e,{emit:t}){const i=e,o=t,{ratio:s,setRatio:n,setFrameShape:r}=Ci(),l=z("4-vertical"),a=z(!0),h=z(!1),c=[{value:"4-vertical",label:"1x4"},{value:6,label:"2x3"},{value:"4-grid",label:"2x2"}],u=[{value:3,label:"3s"},{value:5,label:"5s"},{value:8,label:"8s"}],g=[{value:3/4,label:"3:4"},{value:4/3,label:"4:3"},{value:16/9,label:"16:9"}];function p(M){l.value=M,localStorage.setItem("quantity",M);let T=0,I="",O="";a.value=!0,M==="4-vertical"?(T=4,I="1x4",O="square",h.value=!1,n(4/3)):M==="4-grid"?(T=4,I="2x2",O="grid",h.value=!1,n(3/4)):M===6&&(T=6,I="2x3",O="bigrectangle",h.value=!0,n(4/3)),r(O),i.setQuantity(T,I)}function x(M){i.setTime(M||3)}function b(M){h.value||n(M)}function E(){o("open-frame-modal")}return Dt(()=>{p("4-vertical")}),(M,T)=>{const I=re("a-select");return w(),A("div",go,[m("div",po,[T[0]||(T[0]=m("p",{class:"text-pink"},"Layout Ảnh",-1)),S(I,{options:c,value:l.value,style:{width:"120px","border-radius":"8px","font-size":"14px"},onChange:p},null,8,["value"])]),m("div",vo,[T[1]||(T[1]=m("p",{class:"text-purple"},"Đếm Ngược",-1)),S(I,{options:u,"default-value":3,style:{width:"120px","border-radius":"8px","font-size":"14px"},onChange:x})]),a.value?(w(),A("div",bo,[m("p",wo,ie(l.value==="4-vertical"?"Hỗ Trợ Chụp":"Xem Trước Khung"),1),m("div",yo,[S($(ye),{onClick:E,style:{background:"linear-gradient(135deg, #ffe4ec, #ffd6e8)",color:"#b84f6f","font-weight":"600",border:"1px solid #ffd6e8","border-radius":"8px","box-shadow":"0 3px 10px rgba(255, 182, 193, 0.4)"}},{default:H(()=>[D(ie(l.value==="4-vertical"?"Chọn Khung":"Xem Khung"),1)]),_:1})])])):P("",!0),m("div",xo,[T[2]||(T[2]=m("p",{class:"text-blue"},"Tỷ Lệ Khung Hình",-1)),S(I,{options:g,disabled:h.value,value:$(s),style:{width:"120px","border-radius":"8px","font-size":"14px"},onChange:b},null,8,["disabled","value"])])])}}}),Ao=Be(zo,[["__scopeId","data-v-787efd5a"]]);function gi(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),i.push.apply(i,o)}return i}function _(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?gi(Object(i),!0).forEach(function(o){J(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):gi(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}function J(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function So(e,t){if(e==null)return{};var i,o,s=function(r,l){if(r==null)return{};var a,h,c={},u=Object.keys(r);for(h=0;h<u.length;h++)a=u[h],l.indexOf(a)>=0||(c[a]=r[a]);return c}(e,t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);for(o=0;o<n.length;o++)i=n[o],t.indexOf(i)>=0||Object.prototype.propertyIsEnumerable.call(e,i)&&(s[i]=e[i])}return s}function Re(e){return function(t){if(Array.isArray(t))return Ct(t)}(e)||function(t){if(typeof Symbol<"u"&&t[Symbol.iterator]!=null||t["@@iterator"]!=null)return Array.from(t)}(e)||function(t,i){if(t){if(typeof t=="string")return Ct(t,i);var o=Object.prototype.toString.call(t).slice(8,-1);if(o==="Object"&&t.constructor&&(o=t.constructor.name),o==="Map"||o==="Set")return Array.from(t);if(o==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return Ct(t,i)}}(e)||function(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}()}function Ct(e,t){(t==null||t>e.length)&&(t=e.length);for(var i=0,o=new Array(t);i<t;i++)o[i]=e[i];return o}var pi,Mo,Ze,B=(pi=function(e){/*!
  Copyright (c) 2018 Jed Watson.
  Licensed under the MIT License (MIT), see
  http://jedwatson.github.io/classnames
*/(function(){var t={}.hasOwnProperty;function i(){for(var o=[],s=0;s<arguments.length;s++){var n=arguments[s];if(n){var r=typeof n;if(r==="string"||r==="number")o.push(n);else if(Array.isArray(n)){if(n.length){var l=i.apply(null,n);l&&o.push(l)}}else if(r==="object")if(n.toString===Object.prototype.toString)for(var a in n)t.call(n,a)&&n[a]&&o.push(a);else o.push(n.toString())}}return o.join(" ")}e.exports?(i.default=i,e.exports=i):window.classNames=i})()},pi(Ze={path:Mo,exports:{},require:function(e,t){return function(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}(t==null&&Ze.path)}},Ze.exports),Ze.exports),ne=function(e){return function(t,i){if(!t)return e;var o;typeof t=="string"?o=t:i=t;var s=e;return o&&(s+="__"+o),s+(i?Object.keys(i).reduce(function(n,r){var l=i[r];return l&&(n+=" "+(typeof l=="boolean"?s+"--"+r:s+"--"+r+"_"+l)),n},""):"")}};function jt(e,t,i){var o,s,n,r,l;function a(){var c=Date.now()-r;c<t&&c>=0?o=setTimeout(a,t-c):(o=null,i||(l=e.apply(n,s),n=s=null))}t==null&&(t=100);var h=function(){n=this,s=arguments,r=Date.now();var c=i&&!o;return o||(o=setTimeout(a,t)),c&&(l=e.apply(n,s),n=s=null),l};return h.clear=function(){o&&(clearTimeout(o),o=null)},h.flush=function(){o&&(l=e.apply(n,s),n=s=null,clearTimeout(o),o=null)},h}jt.debounce=jt;var It=jt,R=function(){return R=Object.assign||function(e){for(var t,i=1,o=arguments.length;i<o;i++)for(var s in t=arguments[i])Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s]);return e},R.apply(this,arguments)};/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */function ki(e,t){var i,o;return e&&t?(i=""+e+t[0].toUpperCase()+t.slice(1),o=e+"-"+t):(i=e||t,o=e||t),{name:i,classname:o}}function Oi(e){return/^blob:/.test(e)}function vi(e){return Oi(e)||function(t){return/^data:/.test(t)}(e)}function Ee(e){return!!(e&&e.constructor&&e.call&&e.apply)}function U(e){return e===void 0}function tt(e){return typeof e=="object"&&e!==null}function Lt(e,t,i){var o={};return tt(e)?(Object.keys(t).forEach(function(s){U(e[s])?o[s]=t[s]:tt(t[s])?tt(e[s])?o[s]=Lt(e[s],t[s],i[s]):o[s]=e[s]?t[s]:i[s]:t[s]===!0||t[s]===!1?o[s]=!!e[s]:o[s]=e[s]}),o):e?t:i}function Ke(e){var t=Number(e);return Number.isNaN(t)?e:t}function bi(e){return typeof(e=="number"||function(t){return typeof t=="object"&&t!==null}(e)&&toString.call(e)=="[object Number]")&&!ji(e)}function ji(e){return e!=e}function Ii(e,t){return Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))}var De=function(e,t){e===void 0&&(e={}),t===void 0&&(t={}),this.type="manipulateImage",this.move=e,this.scale=t},Co=function(e,t){t===void 0&&(t={}),this.type="resize",this.directions=e,this.params=t},Bt=function(e){this.type="move",this.directions=e},To=function(){function e(t,i,o,s,n){this.type="drag",this.nativeEvent=t,this.position=o,this.previousPosition=s,this.element=i,this.anchor=n}return e.prototype.shift=function(){var t=this,i=t.element,o=t.anchor,s=t.position;if(i){var n=i.getBoundingClientRect(),r=n.left,l=n.top;return{left:s.left-r-o.left,top:s.top-l-o.top}}return{left:0,top:0}},e}(),Ut={name:"DraggableElement",props:{classname:{type:String}},beforeMount:function(){window.addEventListener("mouseup",this.onMouseUp,{passive:!1}),window.addEventListener("mousemove",this.onMouseMove,{passive:!1}),window.addEventListener("touchmove",this.onTouchMove,{passive:!1}),window.addEventListener("touchend",this.onTouchEnd,{passive:!1})},beforeUnmount:function(){window.removeEventListener("mouseup",this.onMouseUp),window.removeEventListener("mousemove",this.onMouseMove),window.removeEventListener("touchmove",this.onTouchMove),window.removeEventListener("touchend",this.onTouchEnd)},mounted:function(){if(!this.$refs.draggable)throw new Error('You should add ref "draggable" to your root element to use draggable mixin');this.touches=[],this.hovered=!1},methods:{onMouseOver:function(){this.hovered||(this.hovered=!0,this.$emit("enter"))},onMouseLeave:function(){this.hovered&&!this.touches.length&&(this.hovered=!1,this.$emit("leave"))},onTouchStart:function(e){e.cancelable&&!this.disabled&&e.touches.length===1&&(this.touches=Re(e.touches),this.hovered||(this.$emit("enter"),this.hovered=!0),e.touches.length&&this.initAnchor(this.touches.reduce(function(t,i){return{clientX:t.clientX+i.clientX/e.touches.length,clientY:t.clientY+i.clientY/e.touches.length}},{clientX:0,clientY:0})),e.preventDefault&&e.preventDefault(),e.stopPropagation())},onTouchEnd:function(){this.processEnd()},onTouchMove:function(e){this.touches.length&&(this.processMove(e,e.touches),e.preventDefault&&e.preventDefault(),e.stopPropagation&&e.stopPropagation())},onMouseDown:function(e){if(!this.disabled){var t={fake:!0,clientX:e.clientX,clientY:e.clientY};this.touches=[t],this.initAnchor(t),e.stopPropagation()}},onMouseMove:function(e){this.touches.length&&(this.processMove(e,[{fake:!0,clientX:e.clientX,clientY:e.clientY}]),e.preventDefault&&e.preventDefault())},onMouseUp:function(){this.processEnd()},initAnchor:function(e){var t=this.$refs.draggable.getBoundingClientRect(),i=t.left,o=t.right,s=t.bottom,n=t.top;this.anchor={left:e.clientX-i,top:e.clientY-n,bottom:s-e.clientY,right:o-e.clientX}},processMove:function(e,t){var i=Re(t);if(this.touches.length){if(this.touches.length===1&&i.length===1){var o=this.$refs.draggable;this.$emit("drag",new To(e,o,{left:i[0].clientX,top:i[0].clientY},{left:this.touches[0].clientX,top:this.touches[0].clientY},this.anchor))}this.touches=i}},processEnd:function(){this.touches.length&&this.$emit("drag-end"),this.hovered&&(this.$emit("leave"),this.hovered=!1),this.touches=[]}},emits:["drag","drag-end","leave","enter"]};Ut.render=function(e,t,i,o,s,n){return w(),W("div",{ref:"draggable",class:i.classname,onTouchstart:t[1]||(t[1]=function(){return n.onTouchStart&&n.onTouchStart.apply(n,arguments)}),onMousedown:t[2]||(t[2]=function(){return n.onMouseDown&&n.onMouseDown.apply(n,arguments)}),onMouseover:t[3]||(t[3]=function(){return n.onMouseOver&&n.onMouseOver.apply(n,arguments)}),onMouseleave:t[4]||(t[4]=function(){return n.onMouseLeave&&n.onMouseLeave.apply(n,arguments)})},[ze(e.$slots,"default")],34)};var Tt=ne("vue-handler-wrapper"),Li={name:"HandlerWrapper",components:{DraggableElement:Ut},props:{horizontalPosition:{type:String},verticalPosition:{type:String},disabled:{type:Boolean,default:!1}},computed:{classes:function(){var e;if(this.horizontalPosition||this.verticalPosition){var t,i=ki(this.horizontalPosition,this.verticalPosition);e=Tt((J(t={},i.classname,!0),J(t,"disabled",this.disabled),t))}else e=Tt({disabled:this.disabled});return{root:e,draggable:Tt("draggable")}}},emits:["leave","enter","drag","drag-end"]};Li.render=function(e,t,i,o,s,n){var r=re("DraggableElement");return w(),W("div",{class:n.classes.root},[S(r,{class:n.classes.draggable,onDrag:t[1]||(t[1]=function(l){return e.$emit("drag",l)}),onDragEnd:t[2]||(t[2]=function(l){return e.$emit("drag-end")}),onLeave:t[3]||(t[3]=function(l){return e.$emit("leave")}),onEnter:t[4]||(t[4]=function(l){return e.$emit("enter")})},{default:H(function(){return[ze(e.$slots,"default")]}),_:3},8,["class"])],2)};var Eo=ne("vue-line-wrapper"),Wi={name:"LineWrapper",components:{DraggableElement:Ut},props:{position:{type:String,required:!0},disabled:{type:Boolean,default:!1}},computed:{classname:function(){var e;return Eo((J(e={},this.position,!0),J(e,"disabled",this.disabled),e))}},emits:["leave","enter","drag","drag-end"]};Wi.render=function(e,t,i,o,s,n){var r=re("DraggableElement");return w(),W(r,{class:n.classname,onDrag:t[1]||(t[1]=function(l){return e.$emit("drag",l)}),onDragEnd:t[2]||(t[2]=function(l){return e.$emit("drag-end")}),onLeave:t[3]||(t[3]=function(l){return e.$emit("leave")}),onEnter:t[4]||(t[4]=function(l){return e.$emit("enter")})},{default:H(function(){return[ze(e.$slots,"default")]}),_:3},8,["class"])};var ae=["left","right","top","bottom"],_o=["left","right"],ko=["top","bottom"],Oo=["left","top"],jo=["fill-area","fit-area","stencil","none"],wi={left:0,top:0,width:0,height:0};function yi(e,t,i){return!(i=i||["width","height","left","top"]).some(function(o){return e[o]!==t[o]})}function le(e){return{left:e.left,top:e.top,right:e.left+e.width,bottom:e.top+e.height}}function _e(e,t){return{left:e.left-t.left,top:e.top-t.top}}function q(e){return{left:e.left+e.width/2,top:e.top+e.height/2}}function Fe(e,t){var i={left:0,top:0,right:0,bottom:0};return ae.forEach(function(o){var s=t[o],n=le(e)[o];i[o]=s!==void 0&&n!==void 0?o==="left"||o==="top"?Math.max(0,s-n):Math.max(0,n-s):0}),i}function se(e,t){return{left:e.left-t.left,top:e.top-t.top,width:e.width+t.left+t.right,height:e.height+t.top+t.bottom}}function ot(e){return{left:-e.left,top:-e.top}}function K(e,t){return R(R({},e),{left:e.left+t.left,top:e.top+t.top})}function ee(e,t,i,o){if(t!==1){if(i){var s=q(e);return{width:e.width*t,height:e.height*t,left:e.left+e.width*(1-t)/2+(i.left-s.left)*(1-t),top:e.top+e.height*(1-t)/2+(i.top-s.top)*(1-t)}}return{width:e.width*t,height:e.height*t,left:e.left+e.width*(1-t)/2,top:e.top+e.height*(1-t)/2}}return e}function k(e){return e.width/e.height}function ke(e,t){return Math.min(t.right!==void 0&&t.left!==void 0?(t.right-t.left)/e.width:1/0,t.bottom!==void 0&&t.top!==void 0?(t.bottom-t.top)/e.height:1/0)}function Oe(e,t){var i={left:0,top:0},o=Fe(e,t);return o.left&&o.left>0?i.left=o.left:o.right&&o.right>0&&(i.left=-o.right),o.top&&o.top>0?i.top=o.top:o.bottom&&o.bottom>0&&(i.top=-o.bottom),i}function Et(e,t){var i;return t.minimum&&e<t.minimum?i=t.minimum:t.maximum&&e>t.maximum&&(i=t.maximum),i}function $i(e,t){var i=k(e),o=k(t);return t.width<1/0&&t.height<1/0?i>o?{width:t.width,height:t.width/i}:{width:t.height*i,height:t.height}:t.width<1/0?{width:t.width,height:t.width/i}:t.height<1/0?{width:t.height*i,height:t.height}:e}function Pi(e,t){var i=t*Math.PI/180;return{width:Math.abs(e.width*Math.cos(i))+Math.abs(e.height*Math.sin(i)),height:Math.abs(e.width*Math.sin(i))+Math.abs(e.height*Math.cos(i))}}function pe(e,t){var i=t*Math.PI/180;return{left:e.left*Math.cos(i)-e.top*Math.sin(i),top:e.left*Math.sin(i)+e.top*Math.cos(i)}}function st(e,t){var i=Fe(X(e,t),t);return i.left+i.right+i.top+i.bottom?i.left+i.right>i.top+i.bottom?Math.min((e.width+i.left+i.right)/e.width,ke(e,t)):Math.min((e.height+i.top+i.bottom)/e.height,ke(e,t)):1}function X(e,t,i){i===void 0&&(i=!1);var o=Oe(e,t);return K(e,i?ot(o):o)}function Wt(e){return{width:e.right!==void 0&&e.left!==void 0?e.right-e.left:1/0,height:e.bottom!==void 0&&e.top!==void 0?e.bottom-e.top:1/0}}function Io(e,t){return R(R({},e),{minWidth:Math.min(t.width,e.minWidth),minHeight:Math.min(t.height,e.minHeight),maxWidth:Math.min(t.width,e.maxWidth),maxHeight:Math.min(t.height,e.maxHeight)})}function Di(e,t,i){i===void 0&&(i=!0);var o={};return ae.forEach(function(s){var n=e[s],r=t[s];n!==void 0&&r!==void 0?o[s]=s==="left"||s==="top"?i?Math.max(n,r):Math.min(n,r):i?Math.min(n,r):Math.max(n,r):r!==void 0?o[s]=r:n!==void 0&&(o[s]=n)}),o}function at(e,t){return Di(e,t,!0)}function xi(e){var t=e.size,i=e.aspectRatio,o=e.ignoreMinimum,s=e.sizeRestrictions;return!!((t.correctRatio||k(t)>=i.minimum&&k(t)<=i.maximum)&&t.height<=s.maxHeight&&t.width<=s.maxWidth&&t.width&&t.height&&(o||t.height>=s.minHeight&&t.width>=s.minWidth))}function Ri(e,t){return Math.pow(e.width-t.width,2)+Math.pow(e.height-t.height,2)}function de(e){var t=e.width,i=e.height,o=e.sizeRestrictions,s={minimum:e.aspectRatio&&e.aspectRatio.minimum||0,maximum:e.aspectRatio&&e.aspectRatio.maximum||1/0},n={width:Math.max(o.minWidth,Math.min(o.maxWidth,t)),height:Math.max(o.minHeight,Math.min(o.maxHeight,i))};function r(h,c){return c===void 0&&(c=!1),h.reduce(function(u,g){return xi({size:g,aspectRatio:s,sizeRestrictions:o,ignoreMinimum:c})&&(!u||Ri(g,{width:t,height:i})<Ri(u,{width:t,height:i}))?g:u},null)}var l=[];s&&[s.minimum,s.maximum].forEach(function(h){h&&l.push({width:n.width,height:n.width/h,correctRatio:!0},{width:n.height*h,height:n.height,correctRatio:!0})}),xi({size:n,aspectRatio:s,sizeRestrictions:o})&&l.push(n);var a=r(l)||r(l,!0);return a&&{width:a.width,height:a.height}}function $t(e){var t=e.event,i=e.coordinates,o=e.positionRestrictions,s=o===void 0?{}:o,n=K(i,t.directions);return K(n,Oe(n,s))}function Lo(e){var t=e.coordinates,i=e.transform,o=e.imageSize,s=e.sizeRestrictions,n=e.positionRestrictions,r=e.aspectRatio,l=e.visibleArea,a=function(c,u){return $t({coordinates:c,positionRestrictions:n,event:new Bt({left:u.left-c.left,top:u.top-c.top})})},h=R({},t);return(Array.isArray(i)?i:[i]).forEach(function(c){var u={};U((u=typeof c=="function"?c({coordinates:h,imageSize:o,visibleArea:l}):c).width)&&U(u.height)||(h=function(g,p){var x=R(R(R({},g),de({width:p.width,height:p.height,sizeRestrictions:s,aspectRatio:r})),{left:0,top:0});return a(x,{left:g.left,top:g.top})}(h,R(R({},h),u))),U(u.left)&&U(u.top)||(h=a(h,R(R({},h),u)))}),h}function Wo(e){e.event;var t=e.getAreaRestrictions,i=e.boundaries,o=e.coordinates,s=e.visibleArea;e.aspectRatio;var n=e.stencilSize,r=e.sizeRestrictions,l=e.positionRestrictions;e.stencilReference;var a,h,c,u=R({},o),g=R({},s),p=R({},n);a=k(p),h=k(u),c===void 0&&(c=.001),(a===0||h===0?Math.abs(h-a)<c:Math.abs(h/a)<1+c&&Math.abs(h/a)>1-c)||(u=R(R({},u),de({sizeRestrictions:r,width:u.width,height:u.height,aspectRatio:{minimum:k(p),maximum:k(p)}})));var x=st(g=ee(g,u.width*i.width/(g.width*p.width)),t({visibleArea:g,type:"resize"}));return x!==1&&(g=ee(g,x),u=ee(u,x)),g=X(g=K(g,_e(q(u),q(g))),t({visibleArea:g,type:"move"})),{coordinates:u=X(u,at(le(g),l)),visibleArea:g}}function $o(e){var t=e.event,i=e.getAreaRestrictions,o=e.boundaries,s=e.coordinates,n=e.visibleArea;e.aspectRatio,e.stencilSize,e.sizeRestrictions;var r=e.positionRestrictions;e.stencilReference;var l=R({},s),a=R({},n);if(s&&n&&t.type!=="manipulateImage"){var h={width:0,height:0};a.width,o.width,k(o)>k(l)?(h.height=.8*o.height,h.width=h.height*k(l)):(h.width=.8*o.width,h.height=h.width*k(l));var c=st(a=ee(a,l.width*o.width/(a.width*h.width)),i({visibleArea:a,type:"resize"}));a=ee(a,c),c!==1&&(h.height/=c,h.width/=c),a=X(a=K(a,_e(q(l),q(a))),i({visibleArea:a,type:"move"})),l=X(l,at(le(a),r))}return{coordinates:l,visibleArea:a}}function Po(e){var t=e.event,i=e.coordinates,o=e.visibleArea,s=e.getAreaRestrictions,n=R({},o),r=R({},i);if(t.type==="setCoordinates"){var l=Math.max(0,r.width-n.width),a=Math.max(0,r.height-n.height);l>a?n=ee(n,Math.min(r.width/n.width,ke(n,s({visibleArea:n,type:"resize"})))):a>l&&(n=ee(n,Math.min(r.height/n.height,ke(n,s({visibleArea:n,type:"resize"}))))),n=X(n=K(n,ot(Oe(r,le(n)))),s({visibleArea:n,type:"move"}))}return{visibleArea:n,coordinates:r}}function Do(e){var t=e.imageSize,i=e.visibleArea,o=e.coordinates,s=i||t;return{left:(i?i.left:0)+s.width/2-o.width/2,top:(i?i.top:0)+s.height/2-o.height/2}}function Ho(e){var t=e.imageSize,i=e.visibleArea,o=e.aspectRatio,s=e.sizeRestrictions,n=i||t,r=Math.min(o.maximum||1/0,Math.max(o.minimum||0,k(n))),l=n.width<n.height?{width:.8*n.width,height:.8*n.width/r}:{height:.8*n.height,width:.8*n.height*r};return de(R(R({},l),{aspectRatio:o,sizeRestrictions:s}))}function Fo(e){var t,i,o=e.imageSize,s=e.visibleArea,n=e.boundaries,r=e.aspectRatio,l=e.sizeRestrictions,a=e.stencilSize,h=s||o;return k(h)>k(n)?i=(t=a.height*h.height/n.height)*k(a):t=(i=a.width*h.width/n.width)/k(a),de({width:i,height:t,aspectRatio:r,sizeRestrictions:l})}function Bo(e){var t=e.getAreaRestrictions,i=e.coordinates,o=e.imageSize,s=k(e.boundaries);if(i){var n={height:Math.max(i.height,o.height),width:Math.max(i.width,o.width)},r=$i({width:k(n)>s?n.width:n.height*s,height:k(n)>s?n.width/s:n.height},Wt(t())),l={left:i.left+i.width/2-r.width/2,top:i.top+i.height/2-r.height/2,width:r.width,height:r.height},a=Fe(i,le(R({left:0,top:0},o))),h={};return!a.left&&!a.right&&l.width<=o.width&&(h.left=0,h.right=o.width),!a.top&&!a.bottom&&l.height<=o.height&&(h.top=0,h.bottom=o.height),X(l,h)}var c=k(o);return r={height:c>s?o.height:o.width/s,width:c>s?o.height*s:o.width},{left:o.width/2-r.width/2,top:o.height/2-r.height/2,width:r.width,height:r.height}}function Qe(e,t){return Di(e,le(t))}function Uo(e){var t=e.event,i=e.coordinates,o=e.visibleArea,s=e.sizeRestrictions,n=e.getAreaRestrictions,r=e.positionRestrictions,l=e.adjustStencil,a=t.scale,h=t.move,c=R({},o),u=R({},i),g=1,p=1,x=a.factor&&Math.abs(a.factor-1)>.001;c=K(c,{left:h.left||0,top:h.top||0});var b={stencil:{minimum:Math.max(s.minWidth?s.minWidth/u.width:0,s.minHeight?s.minHeight/u.height:0),maximum:Math.min(s.maxWidth?s.maxWidth/u.width:1/0,s.maxHeight?s.maxHeight/u.height:1/0,ke(u,r))},area:{maximum:ke(c,n({visibleArea:c,type:"resize"}))}};a.factor&&x&&(a.factor<1?(p=Math.max(a.factor,b.stencil.minimum))>1&&(p=1):a.factor>1&&(p=Math.min(a.factor,Math.min(b.area.maximum,b.stencil.maximum)))<1&&(p=1)),p&&(c=ee(c,p,a.center));var E=i.left-o.left,M=o.width+o.left-(i.width+i.left),T=i.top-o.top,I=o.height+o.top-(i.height+i.top);return c=X(c=K(c,Oe(c,{left:r.left!==void 0?r.left-E*p:void 0,top:r.top!==void 0?r.top-T*p:void 0,bottom:r.bottom!==void 0?r.bottom+I*p:void 0,right:r.right!==void 0?r.right+M*p:void 0})),n({visibleArea:c,type:"move"})),u.width=u.width*p,u.height=u.height*p,u.left=c.left+E*p,u.top=c.top+T*p,u=X(u,at(le(c),r)),a.factor&&x&&l&&(a.factor>1?g=Math.min(b.area.maximum,a.factor)/p:a.factor<1&&(g=Math.max(u.height/c.height,u.width/c.width,a.factor/p)),g!==1&&(c=K(c=X(c=ee(c,g,a.factor>1?a.center:q(u)),n({visibleArea:c,type:"move"})),ot(Oe(u,le(c)))))),{coordinates:u,visibleArea:c}}function qo(e){var t=e.aspectRatio,i=e.getAreaRestrictions,o=e.coordinates,s=e.visibleArea,n=e.sizeRestrictions,r=e.positionRestrictions,l=e.imageSize,a=e.previousImageSize,h=e.angle,c=R({},o),u=R({},s),g=pe(q(R({left:0,top:0},a)),h);return(c=R(R({},de({sizeRestrictions:n,aspectRatio:t,width:c.width,height:c.height})),pe(q(c),h))).left-=g.left-l.width/2+c.width/2,c.top-=g.top-l.height/2+c.height/2,u=ee(u,st(u,i({visibleArea:u,type:"resize"}))),{coordinates:c=X(c,r),visibleArea:u=X(u=K(u,_e(q(c),q(o))),i({visibleArea:u,type:"move"}))}}function Xo(e){var t=e.flip,i=e.previousFlip,o=e.rotate,s=e.getAreaRestrictions,n=e.coordinates,r=e.visibleArea,l=e.imageSize,a=R({},n),h=R({},r),c=i.horizontal!==t.horizontal,u=i.vertical!==t.vertical;if(c||u){var g=pe({left:l.width/2,top:l.height/2},-o),p=pe(q(a),-o),x=pe({left:c?g.left-(p.left-g.left):p.left,top:u?g.top-(p.top-g.top):p.top},o);a=K(a,_e(x,q(a))),p=pe(q(h),-o),h=X(h=K(h,_e(x=pe({left:c?g.left-(p.left-g.left):p.left,top:u?g.top-(p.top-g.top):p.top},o),q(h))),s({visibleArea:h,type:"move"}))}return{coordinates:a,visibleArea:h}}function zi(e){var t=e.directions,i=e.coordinates,o=e.positionRestrictions,s=o===void 0?{}:o,n=e.sizeRestrictions,r=e.preserveRatio,l=e.compensate,a=R({},t),h=se(i,a).width,c=se(i,a).height;h<0&&(a.left<0&&a.right<0?(a.left=-(i.width-n.minWidth)/(a.left/a.right),a.right=-(i.width-n.minWidth)/(a.right/a.left)):a.left<0?a.left=-(i.width-n.minWidth):a.right<0&&(a.right=-(i.width-n.minWidth))),c<0&&(a.top<0&&a.bottom<0?(a.top=-(i.height-n.minHeight)/(a.top/a.bottom),a.bottom=-(i.height-n.minHeight)/(a.bottom/a.top)):a.top<0?a.top=-(i.height-n.minHeight):a.bottom<0&&(a.bottom=-(i.height-n.minHeight)));var u=Fe(se(i,a),s);l&&(u.left&&u.left>0&&u.right===0?(a.right+=u.left,a.left-=u.left):u.right&&u.right>0&&u.left===0&&(a.left+=u.right,a.right-=u.right),u.top&&u.top>0&&u.bottom===0?(a.bottom+=u.top,a.top-=u.top):u.bottom&&u.bottom>0&&u.top===0&&(a.top+=u.bottom,a.bottom-=u.bottom),u=Fe(se(i,a),s));var g={width:1/0,height:1/0,left:1/0,right:1/0,top:1/0,bottom:1/0};if(ae.forEach(function(b){var E=u[b];E&&a[b]&&(g[b]=Math.max(0,1-E/a[b]))}),r){var p=Math.min.apply(null,ae.map(function(b){return g[b]}));p!==1/0&&ae.forEach(function(b){a[b]*=p})}else ae.forEach(function(b){g[b]!==1/0&&(a[b]*=g[b])});if(h=se(i,a).width,c=se(i,a).height,a.right+a.left&&(h>n.maxWidth?g.width=(n.maxWidth-i.width)/(a.right+a.left):h<n.minWidth&&(g.width=(n.minWidth-i.width)/(a.right+a.left))),a.bottom+a.top&&(c>n.maxHeight?g.height=(n.maxHeight-i.height)/(a.bottom+a.top):c<n.minHeight&&(g.height=(n.minHeight-i.height)/(a.bottom+a.top))),r){var x=Math.min(g.width,g.height);x!==1/0&&ae.forEach(function(b){a[b]*=x})}else g.width!==1/0&&_o.forEach(function(b){a[b]*=g.width}),g.height!==1/0&&ko.forEach(function(b){a[b]*=g.height});return a}function Je(e,t,i){return t==0&&i==0?e/2:t==0?0:i==0?e:e*Math.abs(t/(t+i))}var Vo=ne("vue-simple-handler"),No=ne("vue-simple-handler-wrapper"),qt={name:"SimpleHandler",components:{HandlerWrapper:Li},props:{defaultClass:{type:String},hoverClass:{type:String},wrapperClass:{type:String},horizontalPosition:{type:String},verticalPosition:{type:String},disabled:{type:Boolean,default:!1}},data:function(){return{hover:!1}},computed:{classes:function(){var e,t=(J(e={},this.horizontalPosition,!!this.horizontalPosition),J(e,this.verticalPosition,!!this.verticalPosition),J(e,"".concat(this.horizontalPosition,"-").concat(this.verticalPosition),!!(this.verticalPosition&&this.horizontalPosition)),J(e,"hover",this.hover),e);return{default:B(Vo(t),this.defaultClass,this.hover&&this.hoverClass),wrapper:B(No(t),this.wrapperClass)}}},methods:{onDrag:function(e){this.$emit("drag",e)},onEnter:function(){this.hover=!0},onLeave:function(){this.hover=!1},onDragEnd:function(){this.$emit("drag-end")}},emits:["drag","drag-end"]};qt.render=function(e,t,i,o,s,n){var r=re("HandlerWrapper");return w(),W(r,{class:n.classes.wrapper,"vertical-position":i.verticalPosition,"horizontal-position":i.horizontalPosition,disabled:i.disabled,onDrag:n.onDrag,onDragEnd:n.onDragEnd,onEnter:n.onEnter,onLeave:n.onLeave},{default:H(function(){return[S("div",{class:n.classes.default},null,2)]}),_:1},8,["class","vertical-position","horizontal-position","disabled","onDrag","onDragEnd","onEnter","onLeave"])};var Yo=ne("vue-simple-line"),Go=ne("vue-simple-line-wrapper"),Xt={name:"SimpleLine",components:{LineWrapper:Wi},props:{defaultClass:{type:String},hoverClass:{type:String},wrapperClass:{type:String},position:{type:String},disabled:{type:Boolean,default:!1}},data:function(){return{hover:!1}},computed:{classes:function(){return{root:B(Yo(J({},this.position,!0)),this.defaultClass,this.hover&&this.hoverClass),wrapper:B(Go(J({},this.position,!0)),this.wrapperClass)}}},methods:{onDrag:function(e){this.$emit("drag",e)},onEnter:function(){this.hover=!0},onLeave:function(){this.hover=!1},onDragEnd:function(){this.$emit("drag-end")}},emits:["drag","drag-end"]};Xt.render=function(e,t,i,o,s,n){var r=re("LineWrapper");return w(),W(r,{class:n.classes.wrapper,position:i.position,disabled:i.disabled,onDrag:n.onDrag,onDragEnd:n.onDragEnd,onEnter:n.onEnter,onLeave:n.onLeave},{default:H(function(){return[S("div",{class:n.classes.root},null,2)]}),_:1},8,["class","position","disabled","onDrag","onDragEnd","onEnter","onLeave"])};var _t=ne("vue-bounding-box"),Zo=["east","west",null],Ko=["south","north",null],Hi={name:"BoundingBox",props:{width:{type:Number},height:{type:Number},transitions:{type:Object},handlers:{type:Object,default:function(){return{eastNorth:!0,north:!0,westNorth:!0,west:!0,westSouth:!0,south:!0,eastSouth:!0,east:!0}}},handlersComponent:{type:[Object,String],default:function(){return qt}},handlersClasses:{type:Object,default:function(){return{}}},handlersWrappersClasses:{type:Object,default:function(){return{}}},lines:{type:Object,default:function(){return{west:!0,north:!0,east:!0,south:!0}}},linesComponent:{type:[Object,String],default:function(){return Xt}},linesClasses:{type:Object,default:function(){return{}}},linesWrappersClasses:{type:Object,default:function(){return{}}},resizable:{type:Boolean,default:!0}},data:function(){var e=[];return Zo.forEach(function(t){Ko.forEach(function(i){if(t!==i){var o=ki(t,i),s=o.name,n=o.classname;e.push({name:s,classname:n,verticalDirection:i,horizontalDirection:t})}})}),{points:e}},computed:{style:function(){var e={};return this.width&&this.height&&(e.width="".concat(this.width,"px"),e.height="".concat(this.height,"px"),this.transitions&&this.transitions.enabled&&(e.transition="".concat(this.transitions.time,"ms ").concat(this.transitions.timingFunction))),e},classes:function(){var e=this.handlersClasses,t=this.handlersWrappersClasses,i=this.linesClasses,o=this.linesWrappersClasses;return{root:_t(),handlers:e,handlersWrappers:t,lines:i,linesWrappers:o}},lineNodes:function(){var e=this,t=[];return this.points.forEach(function(i){i.horizontalDirection&&i.verticalDirection||!e.lines[i.name]||t.push({name:i.name,component:e.linesComponent,class:B(e.classes.lines.default,e.classes.lines[i.name],!e.resizable&&e.classes.lines.disabled),wrapperClass:B(e.classes.linesWrappers.default,e.classes.linesWrappers[i.name],!e.resizable&&e.classes.linesWrappers.disabled),hoverClass:e.classes.lines.hover,verticalDirection:i.verticalDirection,horizontalDirection:i.horizontalDirection,disabled:!e.resizable})}),t},handlerNodes:function(){var e=this,t=[],i=this.width,o=this.height;return this.points.forEach(function(s){if(e.handlers[s.name]){var n={name:s.name,component:e.handlersComponent,class:B(e.classes.handlers.default,e.classes.handlers[s.name]),wrapperClass:B(e.classes.handlersWrappers.default,e.classes.handlersWrappers[s.name]),hoverClass:e.classes.handlers.hover,verticalDirection:s.verticalDirection,horizontalDirection:s.horizontalDirection,disabled:!e.resizable};if(i&&o){var r=s.horizontalDirection,l=s.verticalDirection,a=r==="east"?i:r==="west"?0:i/2,h=l==="south"?o:l==="north"?0:o/2;n.wrapperClass=_t("handler"),n.wrapperStyle={transform:"translate(".concat(a,"px, ").concat(h,"px)")},e.transitions&&e.transitions.enabled&&(n.wrapperStyle.transition="".concat(e.transitions.time,"ms ").concat(e.transitions.timingFunction))}else n.wrapperClass=_t("handler",J({},s.classname,!0));t.push(n)}}),t}},beforeMount:function(){window.addEventListener("mouseup",this.onMouseUp,{passive:!1}),window.addEventListener("mousemove",this.onMouseMove,{passive:!1}),window.addEventListener("touchmove",this.onTouchMove,{passive:!1}),window.addEventListener("touchend",this.onTouchEnd,{passive:!1})},beforeUnmount:function(){window.removeEventListener("mouseup",this.onMouseUp),window.removeEventListener("mousemove",this.onMouseMove),window.removeEventListener("touchmove",this.onTouchMove),window.removeEventListener("touchend",this.onTouchEnd)},mounted:function(){this.touches=[]},methods:{onEnd:function(){this.$emit("resize-end")},onHandlerDrag:function(e,t,i){var o,s=e.shift(),n=s.left,r=s.top,l={left:0,right:0,top:0,bottom:0};t==="west"?l.left-=n:t==="east"&&(l.right+=n),i==="north"?l.top-=r:i==="south"&&(l.bottom+=r),!i&&t?o="width":i&&!t&&(o="height"),this.resizable&&this.$emit("resize",new Co(l,{allowedDirections:{left:t==="west"||!t,right:t==="east"||!t,bottom:i==="south"||!i,top:i==="north"||!i},preserveAspectRatio:e.nativeEvent&&e.nativeEvent.shiftKey,respectDirection:o}))}},emits:["resize","resize-end"]};Hi.render=function(e,t,i,o,s,n){return w(),W("div",{ref:"box",class:n.classes.root,style:n.style},[ze(e.$slots,"default"),S("div",null,[(w(!0),W(xe,null,He(n.lineNodes,function(r){return w(),W(it(r.component),{key:r.name,"default-class":r.class,"hover-class":r.hoverClass,"wrapper-class":r.wrapperClass,position:r.name,disabled:r.disabled,onDrag:function(l){return n.onHandlerDrag(l,r.horizontalDirection,r.verticalDirection)},onDragEnd:t[1]||(t[1]=function(l){return n.onEnd()})},null,8,["default-class","hover-class","wrapper-class","position","disabled","onDrag"])}),128))]),(w(!0),W(xe,null,He(n.handlerNodes,function(r){return w(),W("div",{key:r.name,style:r.wrapperStyle,class:r.wrapperClass},[(w(),W(it(r.component),{"default-class":r.class,"hover-class":r.hoverClass,"wrapper-class":r.wrapperClass,"horizontal-position":r.horizontalDirection,"vertical-position":r.verticalDirection,disabled:r.disabled,onDrag:function(l){return n.onHandlerDrag(l,r.horizontalDirection,r.verticalDirection)},onDragEnd:t[2]||(t[2]=function(l){return n.onEnd()})},null,8,["default-class","hover-class","wrapper-class","horizontal-position","vertical-position","disabled","onDrag"]))],6)}),128))],6)};var Qo=ne("vue-draggable-area"),Fi={name:"DraggableArea",props:{movable:{type:Boolean,default:!0},activationDistance:{type:Number,default:20}},computed:{classnames:function(){return{default:Qo()}}},beforeMount:function(){window.addEventListener("mouseup",this.onMouseUp,{passive:!1}),window.addEventListener("mousemove",this.onMouseMove,{passive:!1}),window.addEventListener("touchmove",this.onTouchMove,{passive:!1}),window.addEventListener("touchend",this.onTouchEnd,{passive:!1})},beforeUnmount:function(){window.removeEventListener("mouseup",this.onMouseUp),window.removeEventListener("mousemove",this.onMouseMove),window.removeEventListener("touchmove",this.onTouchMove),window.removeEventListener("touchend",this.onTouchEnd)},mounted:function(){this.touches=[],this.touchStarted=!1},methods:{onTouchStart:function(e){if(e.cancelable){var t=this.movable&&e.touches.length===1;t&&(this.touches=Re(e.touches)),(this.touchStarted||t)&&(e.preventDefault(),e.stopPropagation())}},onTouchEnd:function(){this.touchStarted=!1,this.processEnd()},onTouchMove:function(e){this.touches.length>=1&&(this.touchStarted?(this.processMove(e,e.touches),e.preventDefault(),e.stopPropagation()):Ii({x:this.touches[0].clientX,y:this.touches[0].clientY},{x:e.touches[0].clientX,y:e.touches[0].clientY})>this.activationDistance&&(this.initAnchor({clientX:e.touches[0].clientX,clientY:e.touches[0].clientY}),this.touchStarted=!0))},onMouseDown:function(e){if(this.movable&&e.button===0){var t={fake:!0,clientX:e.clientX,clientY:e.clientY};this.touches=[t],this.initAnchor(t),e.stopPropagation()}},onMouseMove:function(e){this.touches.length&&(this.processMove(e,[{fake:!0,clientX:e.clientX,clientY:e.clientY}]),e.preventDefault&&e.cancelable&&e.preventDefault(),e.stopPropagation())},onMouseUp:function(){this.processEnd()},initAnchor:function(e){var t=this.$refs.container.getBoundingClientRect(),i=t.left,o=t.top;this.anchor={x:e.clientX-i,y:e.clientY-o}},processMove:function(e,t){var i=Re(t);if(this.touches.length){var o=this.$refs.container.getBoundingClientRect(),s=o.left,n=o.top;this.touches.length===1&&i.length===1&&this.$emit("move",new Bt({left:i[0].clientX-(s+this.anchor.x),top:i[0].clientY-(n+this.anchor.y)}))}},processEnd:function(){this.touches.length&&this.$emit("move-end"),this.touches=[]}},emits:["move","move-end"]};Fi.render=function(e,t,i,o,s,n){return w(),W("div",{ref:"container",onTouchstart:t[1]||(t[1]=function(){return n.onTouchStart&&n.onTouchStart.apply(n,arguments)}),onMousedown:t[2]||(t[2]=function(){return n.onMouseDown&&n.onMouseDown.apply(n,arguments)})},[ze(e.$slots,"default")],544)};function kt(e){var t,i;return{rotate:e.rotate||0,flip:{horizontal:((t=e==null?void 0:e.flip)===null||t===void 0?void 0:t.horizontal)||!1,vertical:((i=e==null?void 0:e.flip)===null||i===void 0?void 0:i.vertical)||!1}}}function Jo(e){return new Promise(function(t,i){try{if(e)if(/^data:/i.test(e))t(function(a){a=a.replace(/^data:([^;]+);base64,/gim,"");for(var h=atob(a),c=h.length,u=new ArrayBuffer(c),g=new Uint8Array(u),p=0;p<c;p++)g[p]=h.charCodeAt(p);return u}(e));else if(/^blob:/i.test(e)){var o=new FileReader;o.onload=function(a){t(a.target.result)},n=e,r=function(a){o.readAsArrayBuffer(a)},(l=new XMLHttpRequest).open("GET",n,!0),l.responseType="blob",l.onload=function(){this.status!=200&&this.status!==0||r(this.response)},l.send()}else{var s=new XMLHttpRequest;s.onreadystatechange=function(){s.readyState===4&&(s.status===200||s.status===0?t(s.response):i("Warning: could not load an image to parse its orientation"),s=null)},s.onprogress=function(){s.getResponseHeader("content-type")!=="image/jpeg"&&s.abort()},s.withCredentials=!1,s.open("GET",e,!0),s.responseType="arraybuffer",s.send(null)}else i("Error: the image is empty")}catch(a){i(a)}var n,r,l})}function Bi(e){var t=e.rotate,i=e.flip,o=e.scaleX,s=e.scaleY,n="";return n+=" rotate("+t+"deg) ",n+=" scaleX("+o*(i.horizontal?-1:1)+") ",n+=" scaleY("+s*(i.vertical?-1:1)+") "}function es(e){try{var t,i=new DataView(e),o=void 0,s=void 0,n=void 0,r=void 0;if(i.getUint8(0)===255&&i.getUint8(1)===216)for(var l=i.byteLength,a=2;a+1<l;){if(i.getUint8(a)===255&&i.getUint8(a+1)===225){n=a;break}a++}if(n&&(o=n+10,function(p,x,b){var E,M="";for(E=x,b+=x;E<b;E++)M+=String.fromCharCode(p.getUint8(E));return M}(i,n+4,4)==="Exif")){var h=i.getUint16(o);if(((s=h===18761)||h===19789)&&i.getUint16(o+2,s)===42){var c=i.getUint32(o+4,s);c>=8&&(r=o+c)}}if(r){for(var u=i.getUint16(r,s),g=0;g<u;g++)if(a=r+12*g+2,i.getUint16(a,s)===274){a+=8,t=i.getUint16(a,s),i.setUint16(a,1,s);break}}return t}catch{return null}}function Ai(e,t){var i=t.getBoundingClientRect(),o=i.left,s=i.top,n={left:0,top:0},r=0;return e.forEach(function(l){n.left+=(l.clientX-o)/e.length,n.top+=(l.clientY-s)/e.length}),e.forEach(function(l){r+=Ii({x:n.left,y:n.top},{x:l.clientX-o,y:l.clientY-s})}),{centerMass:n,spread:r,count:e.length}}var Ui={props:{touchMove:{type:Boolean,required:!0},mouseMove:{type:Boolean,required:!0},touchResize:{type:Boolean,required:!0},wheelResize:{type:[Boolean,Object],required:!0},eventsFilter:{type:Function,required:!1}},beforeMount:function(){window.addEventListener("mouseup",this.onMouseUp,{passive:!1}),window.addEventListener("mousemove",this.onMouseMove,{passive:!1}),window.addEventListener("touchmove",this.onTouchMove,{passive:!1}),window.addEventListener("touchend",this.onTouchEnd,{passive:!1})},beforeUnmount:function(){window.removeEventListener("mouseup",this.onMouseUp),window.removeEventListener("mousemove",this.onMouseMove),window.removeEventListener("touchmove",this.onTouchMove),window.removeEventListener("touchend",this.onTouchEnd)},created:function(){this.transforming=!1,this.debouncedProcessEnd=It(this.processEnd),this.touches=[]},methods:{processMove:function(e,t){if(this.touches.length){if(this.touches.length===1&&t.length===1)this.$emit("move",new De({left:this.touches[0].clientX-t[0].clientX,top:this.touches[0].clientY-t[0].clientY}));else if(this.touches.length>1&&this.touchResize){var i=Ai(t,this.$refs.container),o=this.oldGeometricProperties;o.count===i.count&&o.count>1&&this.$emit("resize",new De({left:o.centerMass.left-i.centerMass.left,top:o.centerMass.top-i.centerMass.top},{factor:o.spread/i.spread,center:i.centerMass})),this.oldGeometricProperties=i}this.touches=t}},processEnd:function(){this.transforming&&(this.transforming=!1,this.$emit("transform-end"))},processStart:function(){this.transforming=!0,this.debouncedProcessEnd.clear()},processEvent:function(e){return this.eventsFilter?this.eventsFilter(e,this.transforming)!==!1:(e.preventDefault(),e.stopPropagation(),!0)},onTouchStart:function(e){if(e.cancelable&&(this.touchMove||this.touchResize&&e.touches.length>1)&&this.processEvent(e)){var t=this.$refs.container,i=t.getBoundingClientRect(),o=i.left,s=i.top,n=i.bottom,r=i.right;this.touches=Re(e.touches).filter(function(l){return l.clientX>o&&l.clientX<r&&l.clientY>s&&l.clientY<n}),this.oldGeometricProperties=Ai(this.touches,t)}},onTouchEnd:function(e){e.touches.length===0&&(this.touches=[],this.processEnd())},onTouchMove:function(e){var t=this;if(this.touches.length){var i=Re(e.touches).filter(function(o){return!o.identifier||t.touches.find(function(s){return s.identifier===o.identifier})});this.processEvent(e)&&(this.processMove(e,i),this.processStart())}},onMouseDown:function(e){if(this.mouseMove&&"buttons"in e&&e.buttons===1&&this.processEvent(e)){var t={fake:!0,clientX:e.clientX,clientY:e.clientY};this.touches=[t],this.processStart()}},onMouseMove:function(e){this.touches.length&&this.processEvent(e)&&this.processMove(e,[{clientX:e.clientX,clientY:e.clientY}])},onMouseUp:function(){this.touches=[],this.processEnd()},onWheel:function(e){if(this.wheelResize&&this.processEvent(e)){var t=this.$refs.container.getBoundingClientRect(),i=t.left,o=t.top,s=1+this.wheelResize.ratio*(r=e.deltaY||e.detail||e.wheelDelta,(l=+r)==0||ji(l)?l:l>0?1:-1),n={left:e.clientX-i,top:e.clientY-o};this.$emit("resize",new De({},{factor:s,center:n})),this.touches.length||this.debouncedProcessEnd()}var r,l}},emits:["resize","move","transform-end"]};Ui.render=function(e,t,i,o,s,n){return w(),W("div",{ref:"container",onTouchstart:t[1]||(t[1]=function(){return n.onTouchStart&&n.onTouchStart.apply(n,arguments)}),onMousedown:t[2]||(t[2]=function(){return n.onMouseDown&&n.onMouseDown.apply(n,arguments)}),onWheel:t[3]||(t[3]=function(){return n.onWheel&&n.onWheel.apply(n,arguments)})},[ze(e.$slots,"default")],544)};var Pt={components:{TransformableImage:Ui},props:{touchMove:{type:Boolean,required:!0},mouseMove:{type:Boolean,required:!0},touchResize:{type:Boolean,required:!0},wheelResize:{type:[Boolean,Object],required:!0}},emits:["resize","move"]};Pt.render=function(e,t,i,o,s,n){var r=re("transformable-image");return w(),W(r,{"touch-move":i.touchMove,"touch-resize":i.touchResize,"mouse-move":i.mouseMove,"wheel-resize":i.wheelResize,onMove:t[1]||(t[1]=function(l){return e.$emit("move",l)}),onResize:t[2]||(t[2]=function(l){return e.$emit("resize",l)})},{default:H(function(){return[ze(e.$slots,"default")]}),_:3},8,["touch-move","touch-resize","mouse-move","wheel-resize"])};var et=ne("vue-preview"),qi={props:{coordinates:{type:Object},transitions:{type:Object},image:{type:Object,default:function(){return{}}},imageClass:{type:String},width:{type:Number},height:{type:Number},fill:{type:Boolean}},data:function(){return{calculatedImageSize:{width:0,height:0},calculatedSize:{width:0,height:0}}},computed:{classes:function(){return{root:et({fill:this.fill}),wrapper:et("wrapper"),imageWrapper:et("image-wrapper"),image:B(et("image"),this.imageClass)}},style:function(){if(this.fill)return{};var e={};return this.width&&(e.width="".concat(this.size.width,"px")),this.height&&(e.height="".concat(this.size.height,"px")),this.transitions&&this.transitions.enabled&&(e.transition="".concat(this.transitions.time,"ms ").concat(this.transitions.timingFunction)),e},wrapperStyle:function(){var e={width:"".concat(this.size.width,"px"),height:"".concat(this.size.height,"px"),left:"calc(50% - ".concat(this.size.width/2,"px)"),top:"calc(50% - ".concat(this.size.height/2,"px)")};return this.transitions&&this.transitions.enabled&&(e.transition="".concat(this.transitions.time,"ms ").concat(this.transitions.timingFunction)),e},imageStyle:function(){if(this.coordinates&&this.image){var e=this.coordinates.width/this.size.width,t=_(_({rotate:0,flip:{horizontal:!1,vertical:!1}},this.image.transforms),{},{scaleX:1/e,scaleY:1/e}),i=this.imageSize.width,o=this.imageSize.height,s=Pi({width:i,height:o},t.rotate),n={width:"".concat(i,"px"),height:"".concat(o,"px"),left:"0px",top:"0px"},r={rotate:{left:(i-s.width)*t.scaleX/2,top:(o-s.height)*t.scaleY/2},scale:{left:(1-t.scaleX)*i/2,top:(1-t.scaleY)*o/2}};return n.transform=`translate(
				`.concat(-this.coordinates.left/e-r.rotate.left-r.scale.left,"px,").concat(-this.coordinates.top/e-r.rotate.top-r.scale.top,"px) ")+Bi(t),this.transitions&&this.transitions.enabled&&(n.transition="".concat(this.transitions.time,"ms ").concat(this.transitions.timingFunction)),n}return{}},size:function(){return{width:this.width||this.calculatedSize.width,height:this.height||this.calculatedSize.height}},imageSize:function(){return{width:this.image.width||this.calculatedImageSize.width,height:this.image.height||this.calculatedImageSize.height}}},watch:{image:function(e){(e.width||e.height)&&this.onChangeImage()}},mounted:function(){var e=this;this.onChangeImage(),this.$refs.image.addEventListener("load",function(){e.refreshImage()}),window.addEventListener("resize",this.refresh),window.addEventListener("orientationchange",this.refresh)},unmounted:function(){window.removeEventListener("resize",this.refresh),window.removeEventListener("orientationchange",this.refresh)},methods:{refreshImage:function(){var e=this.$refs.image;this.calculatedImageSize.height=e.naturalHeight,this.calculatedImageSize.width=e.naturalWidth},refresh:function(){var e=this.$refs.root;this.width||(this.calculatedSize.width=e.clientWidth),this.height||(this.calculatedSize.height=e.clientHeight)},onChangeImage:function(){var e=this.$refs.image;e&&e.complete&&this.refreshImage(),this.refresh()}}};qi.render=function(e,t,i,o,s,n){return w(),W("div",{ref:"root",class:n.classes.root,style:n.style},[S("div",{ref:"wrapper",class:n.classes.wrapper,style:n.wrapperStyle},[nt(S("img",{ref:"image",src:i.image&&i.image.src,class:n.classes.image,style:n.imageStyle},null,14,["src"]),[[Ht,i.image&&i.image.src]])],6)],6)};var Xi={components:{Preview:qi},inheritAttrs:!1};Xi.render=function(e,t,i,o,s,n){var r=re("preview");return w(),W(r,Si(e.$attrs,{fill:!0}),null,16)};var Ot=ne("vue-rectangle-stencil"),Vi={name:"RectangleStencil",components:{StencilPreview:Xi,BoundingBox:Hi,DraggableArea:Fi},props:{image:{type:Object},coordinates:{type:Object},stencilCoordinates:{type:Object},handlers:{type:Object},handlersComponent:{type:[Object,String],default:function(){return qt}},lines:{type:Object},linesComponent:{type:[Object,String],default:function(){return Xt}},aspectRatio:{type:[Number,String]},minAspectRatio:{type:[Number,String]},maxAspectRatio:{type:[Number,String]},movable:{type:Boolean,default:!0},resizable:{type:Boolean,default:!0},transitions:{type:Object},movingClass:{type:String},resizingClass:{type:String},previewClass:{type:String},boundingBoxClass:{type:String},linesClasses:{type:Object,default:function(){return{}}},linesWrappersClasses:{type:Object,default:function(){return{}}},handlersClasses:{type:Object,default:function(){return{}}},handlersWrappersClasses:{type:Object,default:function(){return{}}}},data:function(){return{moving:!1,resizing:!1}},computed:{classes:function(){return{stencil:B(Ot({movable:this.movable,moving:this.moving,resizing:this.resizing}),this.moving&&this.movingClass,this.resizing&&this.resizingClass),preview:B(Ot("preview"),this.previewClass),boundingBox:B(Ot("bounding-box"),this.boundingBoxClass)}},style:function(){var e=this.stencilCoordinates,t=e.height,i=e.width,o=e.left,s=e.top,n={width:"".concat(i,"px"),height:"".concat(t,"px"),transform:"translate(".concat(o,"px, ").concat(s,"px)")};return this.transitions&&this.transitions.enabled&&(n.transition="".concat(this.transitions.time,"ms ").concat(this.transitions.timingFunction)),n}},methods:{onMove:function(e){this.$emit("move",e),this.moving=!0},onMoveEnd:function(){this.$emit("move-end"),this.moving=!1},onResize:function(e){this.$emit("resize",e),this.resizing=!0},onResizeEnd:function(){this.$emit("resize-end"),this.resizing=!1},aspectRatios:function(){return{minimum:this.aspectRatio||this.minAspectRatio,maximum:this.aspectRatio||this.maxAspectRatio}}},emits:["resize","resize-end","move","move-end"]};Vi.render=function(e,t,i,o,s,n){var r=re("stencil-preview"),l=re("draggable-area"),a=re("bounding-box");return w(),W("div",{class:n.classes.stencil,style:n.style},[S(a,{width:i.stencilCoordinates.width,height:i.stencilCoordinates.height,transitions:i.transitions,class:n.classes.boundingBox,handlers:i.handlers,"handlers-component":i.handlersComponent,"handlers-classes":i.handlersClasses,"handlers-wrappers-classes":i.handlersWrappersClasses,lines:i.lines,"lines-component":i.linesComponent,"lines-classes":i.linesClasses,"lines-wrappers-classes":i.linesWrappersClasses,resizable:i.resizable,onResize:n.onResize,onResizeEnd:n.onResizeEnd},{default:H(function(){return[S(l,{movable:i.movable,onMove:n.onMove,onMoveEnd:n.onMoveEnd},{default:H(function(){return[S(r,{image:i.image,coordinates:i.coordinates,width:i.stencilCoordinates.width,height:i.stencilCoordinates.height,class:n.classes.preview,transitions:i.transitions},null,8,["image","coordinates","width","height","class","transitions"])]}),_:1},8,["movable","onMove","onMoveEnd"])]}),_:1},8,["width","height","transitions","class","handlers","handlers-component","handlers-classes","handlers-wrappers-classes","lines","lines-component","lines-classes","lines-wrappers-classes","resizable","onResize","onResizeEnd"])],6)};var ts=["transitions"],ue=ne("vue-advanced-cropper"),Ni={name:"Cropper",components:{BackgroundWrapper:Pt},props:{src:{type:String,default:null},stencilComponent:{type:[Object,String],default:function(){return Vi}},backgroundWrapperComponent:{type:[Object,String],default:function(){return Pt}},stencilProps:{type:Object,default:function(){return{}}},autoZoom:{type:Boolean,default:!1},imageClass:{type:String},boundariesClass:{type:String},backgroundClass:{type:String},foregroundClass:{type:String},minWidth:{type:[Number,String]},minHeight:{type:[Number,String]},maxWidth:{type:[Number,String]},maxHeight:{type:[Number,String]},debounce:{type:[Boolean,Number],default:500},transitions:{type:Boolean,default:!0},checkOrientation:{type:Boolean,default:!0},canvas:{type:[Object,Boolean],default:!0},crossOrigin:{type:[Boolean,String],default:void 0},transitionTime:{type:Number,default:300},imageRestriction:{type:String,default:"fit-area",validator:function(e){return jo.indexOf(e)!==-1}},roundResult:{type:Boolean,default:!0},defaultSize:{type:[Function,Object]},defaultPosition:{type:[Function,Object]},defaultVisibleArea:{type:[Function,Object]},defaultTransforms:{type:[Function,Object]},defaultBoundaries:{type:[Function,String],validator:function(e){return!(typeof e=="string"&&e!=="fill"&&e!=="fit")}},priority:{type:String,default:"coordinates"},stencilSize:{type:[Object,Function]},resizeImage:{type:[Boolean,Object],default:!0},moveImage:{type:[Boolean,Object],default:!0},autoZoomAlgorithm:{type:Function},resizeAlgorithm:{type:Function,default:function(e){var t=e.event,i=e.coordinates,o=e.aspectRatio,s=e.positionRestrictions,n=e.sizeRestrictions,r=R(R({},i),{right:i.left+i.width,bottom:i.top+i.height}),l=t.params||{},a=R({},t.directions),h=l.allowedDirections||{left:!0,right:!0,bottom:!0,top:!0};n.widthFrozen&&(a.left=0,a.right=0),n.heightFrozen&&(a.top=0,a.bottom=0),ae.forEach(function(O){h[O]||(a[O]=0)});var c=se(r,a=zi({coordinates:r,directions:a,sizeRestrictions:n,positionRestrictions:s})).width,u=se(r,a).height,g=l.preserveRatio?k(r):Et(c/u,o);if(g){var p=l.respectDirection;if(p||(p=r.width>=r.height||g===1?"width":"height"),p==="width"){var x=c/g-r.height;if(h.top&&h.bottom){var b=a.top,E=a.bottom;a.bottom=Je(x,E,b),a.top=Je(x,b,E)}else h.bottom?a.bottom=x:h.top?a.top=x:h.right?a.right=0:h.left&&(a.left=0)}else if(p==="height"){var M=r.width-u*g;if(h.left&&h.right){var T=a.left,I=a.right;a.left=-Je(M,T,I),a.right=-Je(M,I,T)}else h.left?a.left=-M:h.right?a.right=-M:h.top?a.top=0:h.bottom&&(a.bottom=0)}a=zi({directions:a,coordinates:r,sizeRestrictions:n,positionRestrictions:s,preserveRatio:!0,compensate:l.compensate})}return c=se(r,a).width,u=se(r,a).height,(g=l.preserveRatio?k(r):Et(c/u,o))&&Math.abs(g-c/u)>.001&&ae.forEach(function(O){h[O]||(a[O]=0)}),$t({event:new Bt({left:-a.left,top:-a.top}),coordinates:{width:i.width+a.right+a.left,height:i.height+a.top+a.bottom,left:i.left,top:i.top},positionRestrictions:s})}},moveAlgorithm:{type:Function,default:$t},initStretcher:{type:Function,default:function(e){var t=e.stretcher,i=e.imageSize,o=k(i);t.style.width=i.width+"px",t.style.height=t.clientWidth/o+"px",t.style.width=t.clientWidth+"px"}},fitCoordinates:{type:Function,default:function(e){var t=e.visibleArea,i=e.coordinates,o=e.aspectRatio,s=e.sizeRestrictions,n=e.positionRestrictions,r=R(R({},i),de({width:i.width,height:i.height,aspectRatio:o,sizeRestrictions:{maxWidth:t.width,maxHeight:t.height,minHeight:Math.min(t.height,s.minHeight),minWidth:Math.min(t.width,s.minWidth)}}));return r=X(r=K(r,_e(q(i),q(r))),at(le(t),n))}},fitVisibleArea:{type:Function,default:function(e){var t=e.visibleArea,i=e.boundaries,o=e.getAreaRestrictions,s=e.coordinates,n=R({},t);n.height=n.width/k(i),n.top+=(t.height-n.height)/2,(s.height-n.height>0||s.width-n.width>0)&&(n=ee(n,Math.max(s.height/n.height,s.width/n.width)));var r=ot(Oe(s,le(n=ee(n,st(n,o({visibleArea:n,type:"resize"}))))));return n.width<s.width&&(r.left=0),n.height<s.height&&(r.top=0),n=X(n=K(n,r),o({visibleArea:n,type:"move"}))}},areaRestrictionsAlgorithm:{type:Function,default:function(e){var t=e.visibleArea,i=e.boundaries,o=e.imageSize,s=e.imageRestriction,n=e.type,r={};return s==="fill-area"?r={left:0,top:0,right:o.width,bottom:o.height}:s==="fit-area"&&(k(i)>k(o)?(r={top:0,bottom:o.height},t&&n==="move"&&(t.width>o.width?(r.left=-(t.width-o.width)/2,r.right=o.width-r.left):(r.left=0,r.right=o.width))):(r={left:0,right:o.width},t&&n==="move"&&(t.height>o.height?(r.top=-(t.height-o.height)/2,r.bottom=o.height-r.top):(r.top=0,r.bottom=o.height)))),r}},sizeRestrictionsAlgorithm:{type:Function,default:function(e){return{minWidth:e.minWidth,minHeight:e.minHeight,maxWidth:e.maxWidth,maxHeight:e.maxHeight}}},positionRestrictionsAlgorithm:{type:Function,default:function(e){var t=e.imageSize,i={};return e.imageRestriction!=="none"&&(i={left:0,top:0,right:t.width,bottom:t.height}),i}}},data:function(){return{transitionsActive:!1,imageLoaded:!1,imageAttributes:{width:null,height:null,crossOrigin:null,src:null},defaultImageTransforms:{rotate:0,flip:{horizontal:!1,vertical:!1}},appliedImageTransforms:{rotate:0,flip:{horizontal:!1,vertical:!1}},boundaries:{width:0,height:0},visibleArea:null,coordinates:_({},wi)}},computed:{image:function(){return{src:this.imageAttributes.src,width:this.imageAttributes.width,height:this.imageAttributes.height,transforms:this.imageTransforms}},imageTransforms:function(){return{rotate:this.appliedImageTransforms.rotate,flip:{horizontal:this.appliedImageTransforms.flip.horizontal,vertical:this.appliedImageTransforms.flip.vertical},translateX:this.visibleArea?this.visibleArea.left/this.coefficient:0,translateY:this.visibleArea?this.visibleArea.top/this.coefficient:0,scaleX:1/this.coefficient,scaleY:1/this.coefficient}},imageSize:function(){var e=function(t){return t*Math.PI/180}(this.imageTransforms.rotate);return{width:Math.abs(this.imageAttributes.width*Math.cos(e))+Math.abs(this.imageAttributes.height*Math.sin(e)),height:Math.abs(this.imageAttributes.width*Math.sin(e))+Math.abs(this.imageAttributes.height*Math.cos(e))}},initialized:function(){return!!(this.visibleArea&&this.imageLoaded)},settings:function(){var e=Lt(this.resizeImage,{touch:!0,wheel:{ratio:.1},adjustStencil:!0},{touch:!1,wheel:!1,adjustStencil:!1});return{moveImage:Lt(this.moveImage,{touch:!0,mouse:!0},{touch:!1,mouse:!1}),resizeImage:e}},coefficient:function(){return this.visibleArea?this.visibleArea.width/this.boundaries.width:0},areaRestrictions:function(){return this.imageLoaded?this.areaRestrictionsAlgorithm({imageSize:this.imageSize,imageRestriction:this.imageRestriction,boundaries:this.boundaries}):{}},transitionsOptions:function(){return{enabled:this.transitionsActive,timingFunction:"ease-in-out",time:350}},sizeRestrictions:function(){if(this.boundaries.width&&this.boundaries.height&&this.imageSize.width&&this.imageSize.height){var e=this.sizeRestrictionsAlgorithm({imageSize:this.imageSize,minWidth:U(this.minWidth)?0:Ke(this.minWidth),minHeight:U(this.minHeight)?0:Ke(this.minHeight),maxWidth:U(this.maxWidth)?1/0:Ke(this.maxWidth),maxHeight:U(this.maxHeight)?1/0:Ke(this.maxHeight)});if(e=function(o){var s=o.areaRestrictions,n=o.sizeRestrictions,r=o.boundaries,l=o.positionRestrictions,a=R(R({},n),{minWidth:n.minWidth!==void 0?n.minWidth:0,minHeight:n.minHeight!==void 0?n.minHeight:0,maxWidth:n.maxWidth!==void 0?n.maxWidth:1/0,maxHeight:n.maxHeight!==void 0?n.maxHeight:1/0});l.left!==void 0&&l.right!==void 0&&(a.maxWidth=Math.min(a.maxWidth,l.right-l.left)),l.bottom!==void 0&&l.top!==void 0&&(a.maxHeight=Math.min(a.maxHeight,l.bottom-l.top));var h=Wt(s),c=$i(r,h);return h.width<1/0&&(!a.maxWidth||a.maxWidth>c.width)&&(a.maxWidth=Math.min(a.maxWidth,c.width)),h.height<1/0&&(!a.maxHeight||a.maxHeight>c.height)&&(a.maxHeight=Math.min(a.maxHeight,c.height)),a.minWidth>a.maxWidth&&(a.minWidth=a.maxWidth,a.widthFrozen=!0),a.minHeight>a.maxHeight&&(a.minHeight=a.maxHeight,a.heightFrozen=!0),a}({sizeRestrictions:e,areaRestrictions:this.getAreaRestrictions({visibleArea:this.visibleArea,type:"resize"}),imageSize:this.imageSize,boundaries:this.boundaries,positionRestrictions:this.positionRestrictions,imageRestriction:this.imageRestriction,visibleArea:this.visibleArea,stencilSize:this.getStencilSize()}),this.visibleArea&&this.stencilSize){var t=this.getStencilSize(),i=Wt(this.getAreaRestrictions({visibleArea:this.visibleArea,type:"resize"}));e.maxWidth=Math.min(e.maxWidth,i.width*t.width/this.boundaries.width),e.maxHeight=Math.min(e.maxHeight,i.height*t.height/this.boundaries.height),e.maxWidth<e.minWidth&&(e.minWidth=e.maxWidth),e.maxHeight<e.minHeight&&(e.minHeight=e.maxHeight)}return e}return{minWidth:0,minHeight:0,maxWidth:0,maxHeight:0}},positionRestrictions:function(){return this.positionRestrictionsAlgorithm({imageSize:this.imageSize,imageRestriction:this.imageRestriction})},classes:function(){return{cropper:ue(),image:B(ue("image"),this.imageClass),stencil:ue("stencil"),boundaries:B(ue("boundaries"),this.boundariesClass),stretcher:B(ue("stretcher")),background:B(ue("background"),this.backgroundClass),foreground:B(ue("foreground"),this.foregroundClass),imageWrapper:B(ue("image-wrapper")),cropperWrapper:B(ue("cropper-wrapper"))}},stencilCoordinates:function(){if(this.initialized){var e=this.coordinates,t=e.width,i=e.height,o=e.left,s=e.top;return{width:t/this.coefficient,height:i/this.coefficient,left:(o-this.visibleArea.left)/this.coefficient,top:(s-this.visibleArea.top)/this.coefficient}}return this.defaultCoordinates()},boundariesStyle:function(){var e={width:this.boundaries.width?"".concat(Math.round(this.boundaries.width),"px"):"auto",height:this.boundaries.height?"".concat(Math.round(this.boundaries.height),"px"):"auto",transition:"opacity ".concat(this.transitionTime,"ms"),pointerEvents:this.imageLoaded?"all":"none"};return this.imageLoaded||(e.opacity="0"),e},imageStyle:function(){var e=this.imageAttributes.width>this.imageAttributes.height?{width:Math.min(1024,this.imageAttributes.width),height:Math.min(1024,this.imageAttributes.width)/(this.imageAttributes.width/this.imageAttributes.height)}:{height:Math.min(1024,this.imageAttributes.height),width:Math.min(1024,this.imageAttributes.height)*(this.imageAttributes.width/this.imageAttributes.height)},t={left:(e.width-this.imageSize.width)/(2*this.coefficient),top:(e.height-this.imageSize.height)/(2*this.coefficient)},i={left:(1-1/this.coefficient)*e.width/2,top:(1-1/this.coefficient)*e.height/2},o=_(_({},this.imageTransforms),{},{scaleX:this.imageTransforms.scaleX*(this.imageAttributes.width/e.width),scaleY:this.imageTransforms.scaleY*(this.imageAttributes.height/e.height)}),s={width:"".concat(e.width,"px"),height:"".concat(e.height,"px"),left:"0px",top:"0px",transform:"translate(".concat(-t.left-i.left-this.imageTransforms.translateX,"px, ").concat(-t.top-i.top-this.imageTransforms.translateY,"px)")+Bi(o)};return this.transitionsOptions.enabled&&(s.transition="".concat(this.transitionsOptions.time,"ms ").concat(this.transitionsOptions.timingFunction)),s}},watch:{src:function(){this.onChangeImage()},stencilComponent:function(){var e=this;this.$nextTick(function(){e.resetCoordinates(),e.runAutoZoom("setCoordinates"),e.onChange()})},minWidth:function(){this.onPropsChange()},maxWidth:function(){this.onPropsChange()},minHeight:function(){this.onPropsChange()},maxHeight:function(){this.onPropsChange()},imageRestriction:function(){this.reset()},stencilProps:function(e,t){["aspectRatio","minAspectRatio","maxAspectRatio"].find(function(i){return e[i]!==t[i]})&&this.$nextTick(this.onPropsChange)}},created:function(){this.debouncedUpdate=It(this.update,this.debounce),this.debouncedDisableTransitions=It(this.disableTransitions,this.transitionsOptions.time),this.awaiting=!1},mounted:function(){this.$refs.image.addEventListener("load",this.onSuccessLoadImage),this.$refs.image.addEventListener("error",this.onFailLoadImage),this.onChangeImage(),window.addEventListener("resize",this.refresh),window.addEventListener("orientationchange",this.refresh)},unmounted:function(){window.removeEventListener("resize",this.refresh),window.removeEventListener("orientationchange",this.refresh),this.imageAttributes.revoke&&this.imageAttributes.src&&URL.revokeObjectURL(this.imageAttributes.src),this.debouncedUpdate.clear(),this.debouncedDisableTransitions.clear()},methods:{getResult:function(){var e=this.initialized?this.prepareResult(_({},this.coordinates)):this.defaultCoordinates(),t={rotate:this.imageTransforms.rotate%360,flip:_({},this.imageTransforms.flip)};if(this.src&&this.imageLoaded){var i=this;return{image:this.image,coordinates:e,visibleArea:this.visibleArea?_({},this.visibleArea):null,imageTransforms:t,get canvas(){return i.canvas?i.getCanvas():void 0}}}return{image:this.image,coordinates:e,visibleArea:this.visibleArea?_({},this.visibleArea):null,canvas:void 0,imageTransforms:t}},zoom:function(e,t){var i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},o=i.transitions,s=o===void 0||o;this.onManipulateImage(new De({},{factor:1/e,center:t}),{normalize:!1,transitions:s})},move:function(e,t){var i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},o=i.transitions,s=o===void 0||o;this.onManipulateImage(new De({left:e||0,top:t||0}),{normalize:!1,transitions:s})},setCoordinates:function(e){var t=this,i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},o=i.autoZoom,s=o===void 0||o,n=i.transitions,r=n===void 0||n;this.$nextTick(function(){t.imageLoaded?(t.transitionsActive||(r&&t.enableTransitions(),t.coordinates=t.applyTransform(e),s&&t.runAutoZoom("setCoordinates"),r&&t.debouncedDisableTransitions()),t.onChange()):t.delayedTransforms=e})},refresh:function(){var e=this,t=this.$refs.image;if(this.src&&t)return this.initialized?this.updateVisibleArea().then(function(){e.onChange()}):this.resetVisibleArea().then(function(){e.onChange()})},reset:function(){var e=this;return this.resetVisibleArea().then(function(){e.onChange(!1)})},awaitRender:function(e){var t=this;this.awaiting||(this.awaiting=!0,this.$nextTick(function(){e(),t.awaiting=!1}))},prepareResult:function(e){return this.roundResult?function(t){var i=t.coordinates,o=t.sizeRestrictions,s=t.positionRestrictions,n={width:Math.round(i.width),height:Math.round(i.height),left:Math.round(i.left),top:Math.round(i.top)};return n.width>o.maxWidth?n.width=Math.floor(i.width):n.width<o.minWidth&&(n.width=Math.ceil(i.width)),n.height>o.maxHeight?n.height=Math.floor(i.height):n.height<o.minHeight&&(n.height=Math.ceil(i.height)),X(n,s)}(_(_({},this.getPublicProperties()),{},{positionRestrictions:Qe(this.positionRestrictions,this.visibleArea),coordinates:e})):e},processAutoZoom:function(e,t,i,o){var s=this.autoZoomAlgorithm;s||(s=this.stencilSize?Wo:this.autoZoom?$o:Po);var n=s({event:{type:e,params:o},visibleArea:t,coordinates:i,boundaries:this.boundaries,aspectRatio:this.getAspectRatio(),positionRestrictions:this.positionRestrictions,getAreaRestrictions:this.getAreaRestrictions,sizeRestrictions:this.sizeRestrictions,stencilSize:this.getStencilSize()});return _(_({},n),{},{changed:!yi(n.visibleArea,t)||!yi(n.coordinates,i)})},runAutoZoom:function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},i=t.transitions,o=i!==void 0&&i,s=So(t,ts),n=this.processAutoZoom(e,this.visibleArea,this.coordinates,s),r=n.visibleArea,l=n.coordinates,a=n.changed;o&&a&&this.enableTransitions(),this.visibleArea=r,this.coordinates=l,o&&a&&this.debouncedDisableTransitions()},normalizeEvent:function(e){return function(t){var i=t.event,o=t.visibleArea,s=t.coefficient;if(i.type==="manipulateImage")return R(R({},i),{move:{left:i.move&&i.move.left?s*i.move.left:0,top:i.move&&i.move.top?s*i.move.top:0},scale:{factor:i.scale&&i.scale.factor?i.scale.factor:1,center:i.scale&&i.scale.center?{left:i.scale.center.left*s+o.left,top:i.scale.center.top*s+o.top}:null}});if(i.type==="resize"){var n=R(R({},i),{directions:R({},i.directions)});return ae.forEach(function(l){n.directions[l]*=s}),n}if(i.type==="move"){var r=R(R({},i),{directions:R({},i.directions)});return Oo.forEach(function(l){r.directions[l]*=s}),r}return i}(_(_({},this.getPublicProperties()),{},{event:e}))},getCanvas:function(){if(this.$refs.canvas){var e=this.$refs.canvas,t=this.$refs.image,i=this.imageTransforms.rotate!==0||this.imageTransforms.flip.horizontal||this.imageTransforms.flip.vertical?function(l,a,h){var c=h.rotate,u=h.flip,g={width:a.naturalWidth,height:a.naturalHeight},p=Pi(g,c),x=l.getContext("2d");l.height=p.height,l.width=p.width,x.save();var b=pe(q(R({left:0,top:0},g)),c);return x.translate(-(b.left-p.width/2),-(b.top-p.height/2)),x.rotate(c*Math.PI/180),x.translate(u.horizontal?g.width:0,u.vertical?g.height:0),x.scale(u.horizontal?-1:1,u.vertical?-1:1),x.drawImage(a,0,0,g.width,g.height),x.restore(),l}(this.$refs.sourceCanvas,t,this.imageTransforms):t,o=_({minWidth:0,minHeight:0,maxWidth:1/0,maxHeight:1/0,maxArea:this.maxCanvasSize,imageSmoothingEnabled:!0,imageSmoothingQuality:"high",fillColor:"transparent"},this.canvas),s=function(l){return l.find(function(a){return h=a,!Number.isNaN(parseFloat(h))&&isFinite(h);var h})},n=de({sizeRestrictions:{minWidth:s([o.width,o.minWidth])||0,minHeight:s([o.height,o.minHeight])||0,maxWidth:s([o.width,o.maxWidth])||1/0,maxHeight:s([o.height,o.maxHeight])||1/0},width:this.coordinates.width,height:this.coordinates.height,aspectRatio:{minimum:this.coordinates.width/this.coordinates.height,maximum:this.coordinates.width/this.coordinates.height}});if(o.maxArea&&n.width*n.height>o.maxArea){var r=Math.sqrt(o.maxArea/(n.width*n.height));n={width:Math.round(r*n.width),height:Math.round(r*n.height)}}return function(l,a,h,c,u){l.width=c?c.width:h.width,l.height=c?c.height:h.height;var g=l.getContext("2d");g.clearRect(0,0,l.width,l.height),u&&(u.imageSmoothingEnabled&&(g.imageSmoothingEnabled=u.imageSmoothingEnabled),u.imageSmoothingQuality&&(g.imageSmoothingQuality=u.imageSmoothingQuality),u.fillColor&&(g.fillStyle=u.fillColor,g.fillRect(0,0,l.width,l.height),g.save()));var p=h.left<0?-h.left:0,x=h.top<0?-h.top:0;g.drawImage(a,h.left+p,h.top+x,h.width,h.height,p*(l.width/h.width),x*(l.height/h.height),l.width,l.height)}(e,i,this.coordinates,n,o),e}},update:function(){this.$emit("change",this.getResult())},applyTransform:function(e){var t=arguments.length>1&&arguments[1]!==void 0&&arguments[1],i=this.visibleArea&&t?Io(this.sizeRestrictions,this.visibleArea):this.sizeRestrictions,o=this.visibleArea&&t?Qe(this.positionRestrictions,this.visibleArea):this.positionRestrictions;return Lo({transform:e,coordinates:this.coordinates,imageSize:this.imageSize,sizeRestrictions:i,positionRestrictions:o,aspectRatio:this.getAspectRatio(),visibleArea:this.visibleArea})},resetCoordinates:function(){var e=this;if(this.$refs.image){this.$refs.cropper,this.$refs.image;var t=this.defaultSize;t||(t=this.stencilSize?Fo:Ho);var i=this.sizeRestrictions;i.minWidth,i.minHeight,i.maxWidth,i.maxHeight;var o=Ee(t)?t({boundaries:this.boundaries,imageSize:this.imageSize,aspectRatio:this.getAspectRatio(),sizeRestrictions:this.sizeRestrictions,stencilSize:this.getStencilSize(),visibleArea:this.visibleArea}):t,s=this.defaultPosition||Do,n=[o,function(r){var l=r.coordinates;return _({},Ee(s)?s({coordinates:l,imageSize:e.imageSize,visibleArea:e.visibleArea}):e.defaultPosition)}];this.delayedTransforms&&n.push.apply(n,Re(Array.isArray(this.delayedTransforms)?this.delayedTransforms:[this.delayedTransforms])),this.coordinates=this.applyTransform(n,!0),this.delayedTransforms=null}},clearImage:function(){var e=this;this.imageLoaded=!1,setTimeout(function(){var t=e.$refs.stretcher;t&&(t.style.height="auto",t.style.width="auto"),e.coordinates=e.defaultCoordinates(),e.boundaries={width:0,height:0}},this.transitionTime)},enableTransitions:function(){this.transitions&&(this.transitionsActive=!0)},disableTransitions:function(){this.transitionsActive=!1},updateBoundaries:function(){var e=this,t=this.$refs.stretcher,i=this.$refs.cropper;return this.initStretcher({cropper:i,stretcher:t,imageSize:this.imageSize}),this.$nextTick().then(function(){var o={cropper:i,imageSize:e.imageSize};if(Ee(e.defaultBoundaries)?e.boundaries=e.defaultBoundaries(o):e.defaultBoundaries==="fit"?e.boundaries=function(s){var n=s.cropper,r=s.imageSize,l=n.clientHeight,a=n.clientWidth,h=l,c=r.width*l/r.height;return c>a&&(c=a,h=r.height*a/r.width),{width:c,height:h}}(o):e.boundaries=function(s){var n=s.cropper;return{width:n.clientWidth,height:n.clientHeight}}(o),!e.boundaries.width||!e.boundaries.height)throw new Error("It's impossible to fit the cropper in the current container")})},resetVisibleArea:function(){var e=this;return this.appliedImageTransforms=_(_({},this.defaultImageTransforms),{},{flip:_({},this.defaultImageTransforms.flip)}),this.updateBoundaries().then(function(){e.priority!=="visible-area"&&(e.visibleArea=null,e.resetCoordinates());var t,i,o,s,n,r,l=e.defaultVisibleArea||Bo;e.visibleArea=Ee(l)?l({imageSize:e.imageSize,boundaries:e.boundaries,coordinates:e.priority!=="visible-area"?e.coordinates:null,getAreaRestrictions:e.getAreaRestrictions,stencilSize:e.getStencilSize()}):e.defaultVisibleArea,e.visibleArea=(t={visibleArea:e.visibleArea,boundaries:e.boundaries,getAreaRestrictions:e.getAreaRestrictions},i=t.visibleArea,o=t.boundaries,s=t.getAreaRestrictions,n=R({},i),r=k(o),n.width/n.height!==r&&(n.height=n.width/r),X(n,s({visibleArea:n,type:"move"}))),e.priority==="visible-area"?e.resetCoordinates():e.coordinates=e.fitCoordinates({visibleArea:e.visibleArea,coordinates:e.coordinates,aspectRatio:e.getAspectRatio(),positionRestrictions:e.positionRestrictions,sizeRestrictions:e.sizeRestrictions}),e.runAutoZoom("resetVisibleArea")}).catch(function(){e.visibleArea=null})},updateVisibleArea:function(){var e=this;return this.updateBoundaries().then(function(){e.visibleArea=e.fitVisibleArea({imageSize:e.imageSize,boundaries:e.boundaries,visibleArea:e.visibleArea,coordinates:e.coordinates,getAreaRestrictions:e.getAreaRestrictions}),e.coordinates=e.fitCoordinates({visibleArea:e.visibleArea,coordinates:e.coordinates,aspectRatio:e.getAspectRatio(),positionRestrictions:e.positionRestrictions,sizeRestrictions:e.sizeRestrictions}),e.runAutoZoom("updateVisibleArea")}).catch(function(){e.visibleArea=null})},onChange:function(){var e=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];e&&this.debounce?this.debouncedUpdate():this.update()},onChangeImage:function(){var e,t=this;if(this.imageLoaded=!1,this.delayedTransforms=null,this.src){if(function(s){if(vi(s))return!1;var n=window.location,r=/(\w+:)?(?:\/\/)([\w.-]+)?(?::(\d+))?\/?/.exec(s)||[],l={protocol:r[1]||"",host:r[2]||"",port:r[3]||""},a=function(h){return h.port||((h.protocol||n.protocol)==="http"?80:433)};return!(!l.protocol&&!l.host&&!l.port||l.protocol&&l.protocol==n.protocol&&l.host&&l.host==n.host&&l.host&&a(l)==a(n))}(this.src)){var i=U(this.crossOrigin)?this.canvas:this.crossOrigin;i===!0&&(i="anonymous"),this.imageAttributes.crossOrigin=i||null}if(this.checkOrientation){var o=(e=this.src,new Promise(function(s){Jo(e).then(function(n){var r=es(n);s(n?{source:e,arrayBuffer:n,orientation:r}:{source:e,arrayBuffer:null,orientation:null})}).catch(function(n){console.warn(n),s({source:e,arrayBuffer:null,orientation:null})})}));setTimeout(function(){o.then(t.onParseImage)},this.transitionTime)}else setTimeout(function(){t.onParseImage({source:t.src})},this.transitionTime)}else this.clearImage()},onFailLoadImage:function(){this.imageAttributes.src&&(this.clearImage(),this.$emit("error"))},onSuccessLoadImage:function(){var e=this,t=this.$refs.image;t&&!this.imageLoaded&&(this.imageAttributes.height=t.naturalHeight,this.imageAttributes.width=t.naturalWidth,this.imageLoaded=!0,this.resetVisibleArea().then(function(){e.$emit("ready"),e.onChange(!1)}))},onParseImage:function(e){var t=this,i=e.source,o=e.arrayBuffer,s=e.orientation;this.imageAttributes.revoke&&this.imageAttributes.src&&URL.revokeObjectURL(this.imageAttributes.src),this.imageAttributes.revoke=!1,o&&s&&s>1?Oi(i)||!vi(i)?(this.imageAttributes.src=URL.createObjectURL(new Blob([o])),this.imageAttributes.revoke=!0):this.imageAttributes.src=function(n){for(var r=[],l=new Uint8Array(n);l.length>0;){var a=l.subarray(0,8192);r.push(String.fromCharCode.apply(null,Array.from?Array.from(a):a.slice())),l=l.subarray(8192)}return"data:image/jpeg;base64,"+btoa(r.join(""))}(o):this.imageAttributes.src=i,Ee(this.defaultTransforms)?this.appliedImageTransforms=kt(this.defaultTransforms()):tt(this.defaultTransforms)?this.appliedImageTransforms=kt(this.defaultTransforms):this.appliedImageTransforms=function(n){var r=kt({});if(n)switch(n){case 2:r.flip.horizontal=!0;break;case 3:r.rotate=-180;break;case 4:r.flip.vertical=!0;break;case 5:r.rotate=90,r.flip.vertical=!0;break;case 6:r.rotate=90;break;case 7:r.rotate=90,r.flip.horizontal=!0;break;case 8:r.rotate=-90}return r}(s),this.defaultImageTransforms=_(_({},this.appliedImageTransforms),{},{flip:_({},this.appliedImageTransforms.flip)}),this.$nextTick(function(){var n=t.$refs.image;n&&n.complete&&(function(r){return!!r.naturalWidth}(n)?t.onSuccessLoadImage():t.onFailLoadImage())})},onResizeEnd:function(){this.runAutoZoom("resize",{transitions:!0})},onMoveEnd:function(){this.runAutoZoom("move",{transitions:!0})},onMove:function(e){var t=this;this.transitionsOptions.enabled||this.awaitRender(function(){t.coordinates=t.moveAlgorithm(_(_({},t.getPublicProperties()),{},{positionRestrictions:Qe(t.positionRestrictions,t.visibleArea),coordinates:t.coordinates,event:t.normalizeEvent(e)})),t.onChange()})},onResize:function(e){var t=this;this.transitionsOptions.enabled||this.stencilSize&&!this.autoZoom||this.awaitRender(function(){var i=t.sizeRestrictions,o=Math.min(t.coordinates.width,t.coordinates.height,20*t.coefficient);t.coordinates=t.resizeAlgorithm(_(_({},t.getPublicProperties()),{},{positionRestrictions:Qe(t.positionRestrictions,t.visibleArea),sizeRestrictions:{maxWidth:Math.min(i.maxWidth,t.visibleArea.width),maxHeight:Math.min(i.maxHeight,t.visibleArea.height),minWidth:Math.max(i.minWidth,o),minHeight:Math.max(i.minHeight,o)},event:t.normalizeEvent(e)})),t.onChange(),t.ticking=!1})},onManipulateImage:function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!this.transitionsOptions.enabled){var i=t.transitions,o=i!==void 0&&i,s=t.normalize,n=s===void 0||s;o&&this.enableTransitions();var r=Uo(_(_({},this.getPublicProperties()),{},{event:n?this.normalizeEvent(e):e,getAreaRestrictions:this.getAreaRestrictions,imageRestriction:this.imageRestriction,adjustStencil:!this.stencilSize&&this.settings.resizeImage.adjustStencil})),l=r.visibleArea,a=r.coordinates;this.visibleArea=l,this.coordinates=a,this.runAutoZoom("manipulateImage"),this.onChange(),o&&this.debouncedDisableTransitions()}},onPropsChange:function(){this.coordinates=this.applyTransform(this.coordinates,!0),this.onChange(!1)},getAreaRestrictions:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=e.visibleArea,i=e.type,o=i===void 0?"move":i;return this.areaRestrictionsAlgorithm({boundaries:this.boundaries,imageSize:this.imageSize,imageRestriction:this.imageRestriction,visibleArea:t,type:o})},getAspectRatio:function(e){var t,i,o=this.stencilProps,s=o.aspectRatio,n=o.minAspectRatio,r=o.maxAspectRatio;if(this.$refs.stencil&&this.$refs.stencil.aspectRatios){var l=this.$refs.stencil.aspectRatios();t=l.minimum,i=l.maximum}if(U(t)&&(t=U(s)?n:s),U(i)&&(i=U(s)?r:s),!e&&(U(t)||U(i))){var a=this.getStencilSize(),h=a?k(a):null;U(t)&&(t=bi(h)?h:void 0),U(i)&&(i=bi(h)?h:void 0)}return{minimum:t,maximum:i}},getStencilSize:function(){if(this.stencilSize)return e={currentStencilSize:{width:this.stencilCoordinates.width,height:this.stencilCoordinates.height},stencilSize:this.stencilSize,boundaries:this.boundaries,coefficient:this.coefficient,coordinates:this.coordinates,aspectRatio:this.getAspectRatio(!0)},t=e.boundaries,i=e.stencilSize,o=e.aspectRatio,Et(k(s=Ee(i)?i({boundaries:t,aspectRatio:o}):i),o)&&(s=de({sizeRestrictions:{maxWidth:t.width,maxHeight:t.height,minWidth:0,minHeight:0},width:s.width,height:s.height,aspectRatio:{minimum:o.minimum,maximum:o.maximum}})),(s.width>t.width||s.height>t.height)&&(s=de({sizeRestrictions:{maxWidth:t.width,maxHeight:t.height,minWidth:0,minHeight:0},width:s.width,height:s.height,aspectRatio:{minimum:k(s),maximum:k(s)}})),s;var e,t,i,o,s},getPublicProperties:function(){return{coefficient:this.coefficient,visibleArea:this.visibleArea,coordinates:this.coordinates,boundaries:this.boundaries,sizeRestrictions:this.sizeRestrictions,positionRestrictions:this.positionRestrictions,aspectRatio:this.getAspectRatio(),imageRestriction:this.imageRestriction}},defaultCoordinates:function(){return _({},wi)},flip:function(e,t){var i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},o=i.transitions,s=o===void 0||o;if(!this.transitionsActive){s&&this.enableTransitions();var n=_({},this.imageTransforms.flip),r=Xo({flip:{horizontal:e?!n.horizontal:n.horizontal,vertical:t?!n.vertical:n.vertical},previousFlip:n,rotate:this.imageTransforms.rotate,visibleArea:this.visibleArea,coordinates:this.coordinates,imageSize:this.imageSize,positionRestrictions:this.positionRestrictions,sizeRestrictions:this.sizeRestrictions,getAreaRestrictions:this.getAreaRestrictions,aspectRatio:this.getAspectRatio()}),l=r.visibleArea,a=r.coordinates;e&&(this.appliedImageTransforms.flip.horizontal=!this.appliedImageTransforms.flip.horizontal),t&&(this.appliedImageTransforms.flip.vertical=!this.appliedImageTransforms.flip.vertical),this.visibleArea=l,this.coordinates=a,this.onChange(),s&&this.debouncedDisableTransitions()}},rotate:function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},i=t.transitions,o=i===void 0||i;if(!this.transitionsActive){o&&this.enableTransitions();var s=_({},this.imageSize);this.appliedImageTransforms.rotate+=e;var n=qo({visibleArea:this.visibleArea,coordinates:this.coordinates,previousImageSize:s,imageSize:this.imageSize,angle:e,positionRestrictions:this.positionRestrictions,sizeRestrictions:this.sizeRestrictions,getAreaRestrictions:this.getAreaRestrictions,aspectRatio:this.getAspectRatio()}),r=n.visibleArea,l=n.coordinates,a=this.processAutoZoom("rotateImage",r,l);r=a.visibleArea,l=a.coordinates,this.visibleArea=r,this.coordinates=l,this.onChange(),o&&this.debouncedDisableTransitions()}}},emits:["change","error","ready"]},is={key:0,ref:"canvas",style:{display:"none"}},ns={key:1,ref:"sourceCanvas",style:{display:"none"}};Ni.render=function(e,t,i,o,s,n){return w(),W("div",{ref:"cropper",class:n.classes.cropper},[S("div",{ref:"stretcher",class:n.classes.stretcher},null,2),S("div",{class:n.classes.boundaries,style:n.boundariesStyle},[(w(),W(it(i.backgroundWrapperComponent),{class:n.classes.cropperWrapper,"wheel-resize":n.settings.resizeImage.wheel,"touch-resize":n.settings.resizeImage.touch,"touch-move":n.settings.moveImage.touch,"mouse-move":n.settings.moveImage.mouse,onMove:n.onManipulateImage,onResize:n.onManipulateImage},{default:H(function(){return[S("div",{class:n.classes.background,style:n.boundariesStyle},null,6),S("div",{class:n.classes.imageWrapper},[S("img",{ref:"image",crossorigin:s.imageAttributes.crossOrigin,src:s.imageAttributes.src,class:n.classes.image,style:n.imageStyle,onMousedown:t[1]||(t[1]=wn(function(){},["prevent"]))},null,46,["crossorigin","src"])],2),S("div",{class:n.classes.foreground,style:n.boundariesStyle},null,6),nt((w(),W(it(i.stencilComponent),Si({ref:"stencil",image:n.image,coordinates:s.coordinates,"stencil-coordinates":n.stencilCoordinates,transitions:n.transitionsOptions},i.stencilProps,{onResize:n.onResize,onResizeEnd:n.onResizeEnd,onMove:n.onMove,onMoveEnd:n.onMoveEnd}),null,16,["image","coordinates","stencil-coordinates","transitions","onResize","onResizeEnd","onMove","onMoveEnd"])),[[Ht,s.imageLoaded]]),i.canvas?(w(),W("canvas",is,null,512)):P("",!0),i.canvas?(w(),W("canvas",ns,null,512)):P("",!0)]}),_:1},8,["class","wheel-resize","touch-resize","touch-move","mouse-move","onMove","onResize"]))],6)],2)};const os={class:"d-flex flex-column flex-md-row w-100 gap-1 gap-md-4 justify-content-center align-items-center"},ss={class:"w-100"},as={class:"w-100"},rs={key:0,class:"camera-error"},ls={key:1,class:"d-flex justify-content-center align-items-center camera-container px-3"},hs={key:1,worldly:"",class:"camera-loading-text"},cs={key:2,class:"countdown-overlay"},us={class:"number-overlay z-10"},ds={class:"controls gap-md-5 gap-4 d-flex justify-content-center align-items-center"},fs=["disabled"],ms={class:"d-flex flex-column align-items-center"},gs=["disabled"],ps={class:"mt-2 d-flex align-items-center border rounded-pill",style:{background:`linear-gradient(
                                        135deg,
                                        #fff5f8,
                                        #ffe9ef
                                    )`,padding:"6px 10px","border-radius":"10px","box-shadow":`0 2px 6px
                                        rgba(255, 182, 193, 0.2)`,"white-space":"nowrap","max-width":"100%",gap:"10px"}},vs={class:"toggle-switch",style:{margin:"0","flex-shrink":"0"}},bs=["disabled"],ws={class:"d-flex justify-content-center mt-1",style:{"margin-top":"6px",display:"flex","justify-content":"center"}},ys=["disabled"],xs={class:"beauty-controls mb-3 md:mb-0"},Rs={class:"filter-section"},zs={class:"filter-options"},As=["onClick"],Ss={key:0,class:"photo-gallery-container mt-4"},Ms=["src"],Cs=["onClick"],Ts=["onClick","disabled"],Es={key:1,class:"d-flex justify-content-center align-items-center mt-2"},_s={class:"d-flex justify-content-center align-items-center mt-4"},ks={key:0},Os={key:1,style:{"font-weight":"700"}},js={key:1,class:"next-btn-disable mb-5 d-flex justify-content-center align-items-center text-light"},Is={key:2,class:"storage-error-message"},Ls={class:"modal-footer"},Ws={class:"recap-video-container d-flex flex-column"},$s=["src"],Ps={key:1},Ds={class:"cropper-container"},Hs={class:"modal-footer mt-1 d-flex justify-content-end gap-3"},Fs={__name:"index",setup(e){Rn(d=>({"7bc8f17a":$(Z)}));const t=z(!1);let i=null;const o=z(null),s=()=>{if(o.value instanceof Image||o.value==="loading")return;console.log("Starting to load vintage texture..."),o.value="loading";const d=new Image;d.src="/vintage-texture.png",d.onload=()=>{o.value=d,console.log("Vintage texture loaded and ready.")},d.onerror=()=>{o.value="error",console.error("Error: Could not load the vintage texture image from the /public folder.")}},n=d=>{je.value=d,d==="mono"&&s()},r=oe(()=>({aspectRatio:Z.value})),l=oe(()=>{const d={};return Z.value===3/4?{...d,maxWidth:"650px",width:"88%"}:d}),a=oe(()=>({transform:`scaleX(${V.value==="user"?"-1":"1"})`,filter:Zt.value,"pointer-events":"none"})),h=oe(()=>Z.value===3/4?"is-vertical-preview":null),c=oe(()=>{const d=b.value.findIndex(f=>f===null);return d===-1?"frame-overlay-3":`frame-overlay-${d}`}),u=()=>{const d=navigator.userAgent.toLowerCase();return d.includes("safari")&&!d.includes("chrome")&&!d.includes("crios")&&!d.includes("fxios")},g=()=>{var d;return(d=navigator.userAgentData)!=null&&d.platform?navigator.userAgentData.platform.toLowerCase()==="macos":/mac/i.test(navigator.platform)&&navigator.maxTouchPoints===0},p=z(4),x=z("1x4"),b=z(Array(p.value).fill(null)),E=z(!1),M=z(null),T=z(null),I=z(null),O=z(!1),fe=z(!1),Ae=z(3),V=z("user"),{ratio:Z,frameShape:Se}=Ci(),me=z(!1),he=z(null),j=z(!1);let y=null;const C=()=>{me.value=!0},Y=()=>{me.value=!1},ve=d=>{x.value==="1x4"&&(he.value=d),me.value=!1},Me=()=>{he.value=null},je=z("normal"),N=z(null),Vt=z(null),Yi=z(null),Ie=z(null),Nt=An();let te=null;const Yt=Cn();let be=null,Ue=[],Ce=null;const Q=z(!1),G=z(null),qe=z(!1),Le=z(!1),We=z(null),Xe=z(null),Ve=z(!1),rt=z(null),Te=z(null),Gt=[{name:"normal",label:"Bình thường",style:"none"},{name:"mono",label:"Mono (Có Hiệu Ứng)",style:`
      sepia(0.12)
      brightness(0.9)
    `},{name:"bw",label:"Đen trắng",style:"grayscale(0.9) brightness(1.05)"},{name:"fresh",label:"Tươi tắn",style:"brightness(1.15) contrast(0.9)"},{name:"film",label:"Film",style:`
      sepia(0.2)
      saturate(0.85)
    `}],Zt=oe(()=>{const d=Gt.find(f=>f.name===je.value);return d?d.style:"none"});let we,lt=null;const Gi=async()=>{if(we)return;we=new(window.AudioContext||window.webkitAudioContext);const d=()=>{we.state==="suspended"&&we.resume(),document.removeEventListener("click",d),document.removeEventListener("touchstart",d)};document.addEventListener("click",d),document.addEventListener("touchstart",d);const v=await(await fetch("/shutter.mp3")).arrayBuffer();lt=await we.decodeAudioData(v)},Zi=()=>{if(!lt)return;const d=we.createBufferSource();d.buffer=lt,d.connect(we.destination),d.start(0)},Ki=()=>{const d=document.createElement("div");d.className="flash-effect",d.style.cssText=`
        position: fixed; inset: 0; background: white; opacity: 0;
         z-index: 9999;`,document.body.appendChild(d),requestAnimationFrame(()=>{d.style.opacity="1",setTimeout(()=>{d.style.opacity="0",d.addEventListener("transitionend",()=>d.remove(),{once:!0})},0)})},Kt=async()=>{const d=N.value,f=Vt.value;if(!f||!d||t.value)return;t.value=!0,Zi(),Ki();const v=f.getContext("2d",{willReadFrequently:!0});f.width=d.videoWidth,f.height=d.videoHeight,v.save(),V.value==="user"&&(v.translate(f.width,0),v.scale(-1,1)),v.drawImage(d,0,0,f.width,f.height),v.restore();const L=await new Promise(F=>{const ce=v.getImageData(0,0,f.width,f.height);i.onmessage=ge=>{F(ge.data)},i.postMessage({imageData:ce,filterName:je.value},[ce.data.buffer])});if(v.putImageData(L,0,0),je.value==="mono"&&o.value instanceof Image){v.save(),v.globalAlpha=.68,v.globalCompositeOperation="overlay";const F=[0,Math.PI/2,Math.PI,3*Math.PI/2],ce=F[Math.floor(Math.random()*F.length)],ge=Math.random()<.5,dt=Math.random()<.5;v.translate(f.width/2,f.height/2),v.rotate(ce),ge&&v.scale(-1,1),dt&&v.scale(1,-1),v.translate(-f.width/2,-f.height/2),v.drawImage(o.value,0,0,f.width,f.height),v.restore()}f.toBlob(F=>{if(F){const ce=URL.createObjectURL(F),ge=b.value.findIndex(dt=>!dt);ge!==-1&&(b.value[ge]&&URL.revokeObjectURL(b.value[ge]),b.value[ge]=ce)}t.value=!1},"image/jpeg",1)},Qt=co(()=>{O.value||Kt()},0),Qi=()=>{if(O.value||b.value.filter(f=>f).length>=p.value||Le.value&&Q.value)return;O.value=!0,G.value=null,Le.value&&en();const d=()=>{if(b.value.filter(L=>L).length>=p.value){O.value=!1,I.value=null,Le.value&&Q.value&&Ne();return}let f=Ae.value;I.value=f;const v=setInterval(()=>{f--,f<=0?(clearInterval(v),I.value=null,Kt(),setTimeout(d,1e3)):I.value=f},1e3)};d()};async function ht(){if(E.value=!1,M.value=null,te&&(te.getTracks().forEach(L=>L.stop()),te=null),!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia){M.value="Thiết bị không hỗ trợ camera.";return}let d;const f=u(),v=g();f&&v?d={video:{facingMode:V.value,aspectRatio:4/3}}:f&&!v?d={video:{width:{ideal:3840},height:{ideal:2160},facingMode:V.value,aspectRatio:4/3,frameRate:{max:30}}}:d={video:{facingMode:V.value,width:{ideal:3840},height:{ideal:2160},aspectRatio:4/3,frameRate:{max:30}}};try{te=await navigator.mediaDevices.getUserMedia(d),N.value&&(N.value.srcObject=te,N.value.onloadedmetadata=()=>{E.value=!0;const L=te.getVideoTracks()[0].getSettings();console.log(`Camera initialized with resolution: ${L.width}x${L.height}`)})}catch(L){console.error("Failed to get camera with preferred constraints:",L.name,L.message);try{console.log("Retrying with the most basic fallback constraints...");const F={video:{facingMode:V.value}};te=await navigator.mediaDevices.getUserMedia(F),N.value&&(N.value.srcObject=te,N.value.onloadedmetadata=()=>{E.value=!0;const ce=te.getVideoTracks()[0].getSettings();console.log(`Camera initialized with fallback resolution: ${ce.width}x${ce.height}`)})}catch(F){console.error("Failed to get camera even with fallback constraints:",F),M.value="Không thể truy cập camera. Vui lòng kiểm tra quyền truy cập hoặc thiết bị của bạn.",E.value=!1}}}function Ji(){V.value=V.value==="user"?"environment":"user",ht()}function ct(){if(!N.value||!Ie.value||!E.value){Ce=requestAnimationFrame(ct);return}const d=N.value,f=Ie.value,v=f.getContext("2d");f.width=d.videoWidth,f.height=d.videoHeight,v.filter=Zt.value,v.save(),V.value==="user"&&(v.translate(f.width,0),v.scale(-1,1)),v.drawImage(d,0,0,f.width,f.height),v.restore(),v.filter="none",Ce=requestAnimationFrame(ct)}async function en(){if(Q.value||!Ie.value)return;Ue=[],G.value=null;const d=Ie.value;d.width=N.value?N.value.videoWidth:1280,d.height=N.value?N.value.videoHeight:720;let v=["video/mp4; codecs=avc1","video/webm; codecs=vp9","video/webm; codecs=vp8","video/webm"].find(L=>MediaRecorder.isTypeSupported(L));if(!v){M.value="Trình duyệt không hỗ trợ ghi video.";return}try{const L=d.captureStream(30);be=new MediaRecorder(L,{mimeType:v,videoBitsPerSecond:12e6}),be.ondataavailable=F=>{F.data.size>0&&Ue.push(F.data)},be.onstop=()=>{const F=new Blob(Ue,{type:v.split(";")[0]});G.value=URL.createObjectURL(F),Ue=[]},be.start(),Q.value=!0,Ce=requestAnimationFrame(ct)}catch{Q.value=!1,alert("Không thể bắt đầu ghi recap video.")}}function Ne(){Q.value&&be&&be.state!=="inactive"&&(be.stop(),Q.value=!1,Ce&&(cancelAnimationFrame(Ce),Ce=null))}const tn=()=>{const d=b.value.findIndex(f=>f===null);if(d===-1){alert("Bạn đã tải lên đủ số lượng ảnh.");return}Te.value=d,We.value&&We.value.click()},nn=d=>{b.value[d]||O.value||Q.value||(Te.value=d,We.value&&We.value.click())},on=d=>{const f=d.target.files[0];if(f&&f.type.startsWith("image/")){const v=new FileReader;v.onload=L=>{rt.value=L.target.result,Ve.value=!0},v.readAsDataURL(f)}d.target.value=null},sn=()=>{if(Xe.value){const{canvas:d}=Xe.value.getResult();if(d){const f=d.toDataURL("image/jpeg",1);Te.value!==null&&b.value[Te.value]===null&&(b.value[Te.value]=f),ut()}}},ut=()=>{Ve.value=!1,rt.value=null,Xe.value=null,Te.value=null};function an(){I.value=null,O.value=!1,b.value.forEach(d=>{d&&URL.revokeObjectURL(d)}),b.value=Array(p.value).fill(null),T.value=null,Ne(),G.value=null}function rn(d){b.value[d]=null,T.value=null}function ln(d){Ae.value=d}function hn(d,f){p.value=d,x.value=f,b.value=Array(p.value).fill(null),Me(),localStorage.setItem("layoutMode",f)}function cn(){M.value=null,ht()}async function un(){if(!fe.value){fe.value=!0,T.value=null,Ne();try{const d=b.value.filter(f=>f);Yt.setPhotos(d),j.value=!0,y=setTimeout(()=>{j.value=!1,Nt.push({name:"download"})},5e3)}catch{T.value="Không thể xử lý ảnh. Vui lòng thử lại.",fe.value=!1}}}function dn(){y&&clearTimeout(y),j.value=!1,setTimeout(()=>{Nt.push({name:"download"})},200)}function fn(){qe.value=!1;const d=document.querySelector(".recap-video-player");d&&d.pause()}function mn(){if(G.value){const d=document.createElement("a");d.href=G.value,d.download="photobooth_recap.mp4",document.body.appendChild(d),d.click(),document.body.removeChild(d)}}return Dt(()=>{Yt.clearPhotos(),ht(),G.value&&(URL.revokeObjectURL(G.value),G.value=null),i=new Worker(new URL("/build/assets/filter.worker-CgwbDAPr.js",import.meta.url),{type:"module"}),Gi()}),yn(()=>{y&&clearTimeout(y),Ne(),G.value&&URL.revokeObjectURL(G.value),te&&te.getTracks().forEach(d=>d.stop()),N.value&&(N.value.srcObject=null),i&&i.terminate()}),(d,f)=>(w(),A(xe,null,[m("div",null,[m("div",os,[m("div",null,[S(mo),m("div",{class:"photobooth-container d-flex align-items-center",style:Ge(l.value)},[m("div",ss,[m("div",as,[S(Ao,{setTime:ln,setQuantity:hn,previewFrame:he.value,onOpenFrameModal:C,onRemoveFrame:Me},null,8,["previewFrame"])])]),m("div",{class:"camera-preview relative",style:Ge(r.value)},[M.value?(w(),A("div",rs,[m("p",null,"❌ "+ie(M.value),1),m("button",{onClick:cn},"Thử Lại")])):(w(),A("div",ls,[he.value?(w(),A("div",{key:0,class:$e(["frame-overlay-bg",c.value]),style:Ge({backgroundImage:"url("+he.value+")"})},null,6)):P("",!0),m("video",{ref_key:"videoRef",ref:N,autoplay:"",playsinline:"",muted:"",class:$e(["camera-feed-square",h.value]),style:Ge(a.value)},null,6),m("canvas",{ref_key:"captureCanvasRef",ref:Vt,style:{display:"none"}},null,512),m("canvas",{ref_key:"filterProcessingCanvasRef",ref:Yi,style:{display:"none"}},null,512),m("canvas",{ref_key:"recapCanvasRef",ref:Ie,style:{display:"none"}},null,512),m("button",{onClick:Ji,class:"btn-toggle-camera d-flex align-items-center z-10"},[S($(Ft))]),!E.value&&!M.value?(w(),A("div",hs," Đang khởi động camera... ")):P("",!0),I.value!==null?(w(),A("div",cs,[m("span",null,ie(I.value),1)])):P("",!0),m("div",us," Đã Chụp "+ie(b.value.filter(v=>v).length)+"/"+ie(p.value),1)]))],4),S(Kn,{visible:me.value,"current-shape":$(Se),onSelect:ve,onClose:Y},null,8,["visible","current-shape"]),m("div",ds,[m("button",{class:"btn-hand d-flex flex-column justify-content-center align-items-center",onClick:f[0]||(f[0]=(...v)=>$(Qt)&&$(Qt)(...v)),disabled:!E.value||b.value.filter(v=>v).length>=p.value||O.value||Q.value||t.value},f[6]||(f[6]=[m("img",{src:"https://cdn-icons-png.flaticon.com/512/3280/3280594.png",alt:"camera",style:{width:"2.5rem",height:"2.5rem","object-fit":"contain","margin-bottom":"4px"}},null,-1),D(" Chụp tay ",-1)]),8,fs),m("div",ms,[m("button",{onClick:Qi,class:"btn-auto d-flex flex-column justify-content-center align-items-center",disabled:!E.value||b.value.filter(v=>v).length>=p.value||O.value||Q.value},f[7]||(f[7]=[m("img",{src:"https://cdn-icons-png.flaticon.com/512/1042/1042339.png ",style:{width:"3rem",height:"3rem","object-fit":"contain","margin-bottom":"4px"}},null,-1),D(" AUTO ",-1)]),8,gs),m("div",ps,[m("div",vs,[nt(m("input",{class:"toggle-input",id:"recordRecapToggle",type:"checkbox","onUpdate:modelValue":f[1]||(f[1]=v=>Le.value=v)},null,512),[[xn,Le.value]]),f[8]||(f[8]=m("label",{class:"toggle-label",for:"recordRecapToggle"},null,-1))]),f[9]||(f[9]=m("label",{for:"recordRecapToggle",style:{"font-size":"14px",color:"#b0235c","font-weight":"500",cursor:"pointer","user-select":"none",margin:"0","white-space":"nowrap","line-height":"24px"}}," Video Recap ",-1))])]),m("button",{onClick:an,class:"btn-again",disabled:b.value.filter(v=>v).length===0||Q.value},f[10]||(f[10]=[m("img",{src:"   https://cdn-icons-png.flaticon.com/512/5894/5894373.png ",alt:"Chụp lại",style:{width:"2.5rem",height:"2.5rem","object-fit":"contain","margin-bottom":"4px"}},null,-1),D(" Chụp Lại ",-1)]),8,bs)]),m("div",ws,[m("input",{type:"file",ref_key:"fileInputRef",ref:We,onChange:on,accept:"image/*",style:{display:"none"}},null,544),m("button",{onClick:tn,disabled:b.value.filter(v=>v).length>=p.value||O.value||Q.value,style:{display:"flex","align-items":"center",gap:"6px",background:`linear-gradient(
                                    135deg,
                                    #d2f4f9,
                                    #f0fbff
                                )`,color:"#087ea4",border:"1px solid #b5eaf5",padding:"8px 17px","font-size":"14px","font-weight":"600","border-radius":"16px","box-shadow":"0 4px 8px rgba(173, 216, 230, 0.3)",cursor:"pointer",transition:"all 0.2s ease"}},f[11]||(f[11]=[m("img",{src:"https://cdn-icons-png.flaticon.com/512/8191/8191581.png ",alt:"Upload",style:{width:"1.2rem",height:"1.2rem","object-fit":"contain"}},null,-1),D(" Tải ảnh lên ",-1)]),8,ys)])],4),m("div",xs,[m("div",Rs,[f[13]||(f[13]=m("h3",{class:"d-flex align-items-center justify-content-start"}," Bộ lọc màu ",-1)),m("div",zs,[(w(),A(xe,null,He(Gt,(v,L)=>m("div",{key:L,class:$e(["filter-option",{active:je.value===v.name}]),onClick:F=>n(v.name)},[f[12]||(f[12]=m("div",{class:"filter-preview"},null,-1)),m("span",null,ie(v.label),1)],10,As)),64))])])])]),m("div",null,[b.value.length>0?(w(),A("div",Ss,[m("div",{class:$e({"photo-gallery":!0,"photo-gallery-six":x.value==="2x3","photo-gallery-four-grid":x.value==="2x2"})},[(w(!0),A(xe,null,He(b.value,(v,L)=>(w(),A("div",{key:L,class:"photo-card"},[m("div",{class:$e($(Z)===4/3?"photo-frame-square":"photo-frame")},[v?(w(),A("img",{key:0,src:v,class:"photo-thumbnail",style:{objectFit:"cover",width:"100%",height:"100%"}},null,8,Ms)):P("",!0)],2),v?(w(),A("button",{key:0,class:"btn btn-delete",onClick:F=>rn(L),style:{"background-color":"#ffd1dc",color:"white","border-radius":"50%",width:"30px",height:"30px",border:"none",display:"flex","align-items":"center","justify-content":"center","box-shadow":`0 2px 4px
                                        rgba(255, 163, 158, 0.1)`}},[S($(Sn),{style:{"font-size":"16px"}})],8,Cs)):P("",!0),v?P("",!0):(w(),A("button",{key:1,class:"btn-upload-individual",onClick:F=>nn(L),disabled:O.value||Q.value},f[14]||(f[14]=[m("img",{src:"https://cdn-icons-png.flaticon.com/512/8191/8191581.png",alt:"Tải ảnh lên"},null,-1),m("span",null,"Upload",-1)]),8,Ts))]))),128))],2)])):P("",!0),G.value?(w(),A("div",Es,[m("button",{onClick:f[2]||(f[2]=v=>qe.value=!0),class:"btn-recap"}," Xem Video Recap ")])):P("",!0),m("div",_s,[b.value.filter(v=>v).length===p.value?(w(),A("div",{key:0,class:"next-btn mb-5 mb-md-0",onClick:un},[fe.value?(w(),A("span",ks,"Đang xử lý...")):(w(),A("span",Os,f[15]||(f[15]=[D(" Tiếp tục ",-1),m("span",{style:{"font-size":"0.8em",display:"block","margin-top":"2px"}}," (Bước Chọn Frame) ",-1)])))])):(w(),A("div",js,ie(b.value.filter(v=>v).length)+"/"+ie(p.value),1))]),T.value?(w(),A("div",Is,ie(T.value),1)):P("",!0)])]),S($(Pe),{visible:j.value,"onUpdate:visible":f[3]||(f[3]=v=>j.value=v),title:"Thông báo",footer:null,closable:!1,centered:"",class:"custom-modal","wrap-class-name":"custom-modal-wrapper"},{default:H(()=>[f[17]||(f[17]=m("p",{class:"modal-message"}," Website không lưu trữ bất kì thông tin hay hình ảnh nào của bạn đâu nha. Cứ an tâm 100% khi sử dụng nhé! 💗 ",-1)),m("div",Ls,[S($(ye),{type:"primary",onClick:dn,class:"confirm-button"},{default:H(()=>f[16]||(f[16]=[m("span",{class:"button-text"},"Tiếp Tục",-1)])),_:1,__:[16]})])]),_:1,__:[17]},8,["visible"]),S($(Pe),{visible:qe.value,"onUpdate:visible":f[4]||(f[4]=v=>qe.value=v),title:"Recap Video của bạn",footer:null,closable:!0,centered:"",class:"custom-modal","wrap-class-name":"custom-modal-wrapper",onCancel:fn},{default:H(()=>[m("div",Ws,[G.value?(w(),A("video",{key:0,src:G.value,controls:"",autoplay:"",loop:"",class:"recap-video-player mx-auto"},null,8,$s)):(w(),A("p",Ps,"Không có video recap nào.")),G.value?(w(),W($(ye),{key:2,type:"primary",onClick:mn,class:"download-recap-button text-center w-50 mx-auto mt-3 mb-2"},{default:H(()=>f[18]||(f[18]=[D(" Tải Video Recap ",-1)])),_:1,__:[18]})):P("",!0),f[19]||(f[19]=m("div",{class:"mx-auto text-center",role:"alert",style:{background:"linear-gradient(135deg, #fff8f8, #ffeaea)",color:"#880808","font-size":"0.88em",padding:"14px 20px","border-radius":"14px","box-shadow":"0 4px 10px rgba(255, 0, 0, 0.1)","max-width":"600px","line-height":"1.6","font-family":"'Inter', sans-serif"}},[m("p",{style:{margin:"0","font-weight":"600",color:"#b30000","border-bottom":"1px dashed #ff9e9e","padding-bottom":"6px","margin-bottom":"8px"}},[D(" ⚠️ "),m("span",{style:{color:"#ff0000"}},"Video Recap"),D(" hay lỗi với những thiết bị "),m("b",null,"Android"),D(" hoặc "),m("b",null,"iOS"),D(" đời thấp. ")]),m("p",{style:{margin:"0"}},[D(" 💡 "),m("b",{style:{color:"#008000"}},"Mẹo :"),D(" Nếu video bị chậm, giật hãy cho vào "),m("span",{style:{color:"#006400","font-weight":"600"}},"Capcut"),D(" xuất "),m("span",{style:{color:"#1e90ff","font-weight":"600"}},"x1,5"),D(", "),m("span",{style:{color:"#1e90ff","font-weight":"600"}},"x2"),D(" tốc độ lên sẽ tạo thành Video có hiệu ứng rất đẹp. "),m("br"),D(" Rồi cầm video đấy đi "),m("span",{style:{color:"#006400","font-weight":"600"}},"Capcut"),m("span",{style:{"font-style":"italic"}}," giật giật"),D(" thôi ^^ ")])],-1))])]),_:1},8,["visible"]),S($(Pe),{visible:Ve.value,"onUpdate:visible":f[5]||(f[5]=v=>Ve.value=v),title:"Cắt & Điều chỉnh ảnh",footer:null,closable:!0,centered:"",width:"80vw",destroyOnClose:!0,onCancel:ut},{default:H(()=>[m("div",Ds,[S($(Ni),{ref_key:"cropperRef",ref:Xe,src:rt.value,"stencil-props":{aspectRatio:$(Z)},canvas:{height:500}},null,8,["src","stencil-props"])]),f[22]||(f[22]=m("div",{class:"mt-2 p-1 border border-success rounded text-center mx-auto text-success text-sm",style:{"font-size":"13px",width:"fit-content"}}," Có thể kéo giãn, di chuyển vùng chọn để tùy chỉnh to nhỏ ảnh tùy í và có thể zoom to, zoom nhỏ ảnh gốc. ",-1)),m("div",Hs,[S($(ye),{onClick:ut},{default:H(()=>f[20]||(f[20]=[D("Hủy",-1)])),_:1,__:[20]}),S($(ye),{type:"primary",onClick:sn,class:"confirm-button"},{default:H(()=>f[21]||(f[21]=[m("span",{class:"button-text"},"Xác nhận",-1)])),_:1,__:[21]})])]),_:1,__:[22]},8,["visible"])]),S(Mn)],64))}},Ys=Be(Fs,[["__scopeId","data-v-96c3751a"]]);export{Ys as default};
